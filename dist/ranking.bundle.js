/*! For license information please see ranking.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={165:(e,t,n)=>{n.d(t,{g:()=>r});const i=document.getElementById("sign-in-btn");function r(){const{origin:e}=window.location,t=sessionStorage.getItem("login");t&&JSON.parse(t).loggedIn?i&&(i.style.display="none"):window.location.href=`${e}/pages/auth/login.html`}},712:(e,t,n)=>{n.d(t,{A:()=>i});const i=class{constructor(){this.injectErrorBlock(),this.trackErrors()}injectErrorBlock(){this.errorBlock=document.createElement("div"),this.errorBlock.classList.add("error-block"),document.body.appendChild(this.errorBlock)}errorElementConstructor({message:e,type:t}){const n=document.createElement("div");n.setAttribute("data-date",new Date),n.classList.add("error-container",t);const i=document.createElement("div");i.classList.add("error-element",t);const r=document.createElement("i");"error"===t&&r.classList.add("fas","fa-exclamation-circle"),"warning"===t&&r.classList.add("fas","fa-exclamation-triangle"),"info"===t&&r.classList.add("fas","fa-info-circle");const s=document.createElement("span");s.classList.add("error-message"),s.textContent=e;const o=document.createElement("button");o.classList.add("error-close-btn"),o.textContent="X";const a=document.createElement("div");a.classList.add("expiry-block");const c=document.createElement("span");return c.classList.add("expiry-span"),a.appendChild(c),i.appendChild(r),i.appendChild(s),i.appendChild(o),n.appendChild(i),n.appendChild(a),o.addEventListener("click",(()=>{n.remove()})),n}consoleError=e=>{this.errorBlock.style.display="grid",this.errorBlock.appendChild(this.errorElementConstructor({message:e,type:"error"})),console.error(e)};consoleWarn=e=>{this.errorBlock.style.display="grid",this.errorBlock.appendChild(this.errorElementConstructor({message:e,type:"warning"})),console.warn(e)};consoleInfo=e=>{this.errorBlock.style.display="grid",this.errorBlock.appendChild(this.errorElementConstructor({message:e,type:"info"})),console.info(e)};trackErrors(){const e=document.querySelectorAll(".error-container");e.forEach((e=>{const t=new Date(e.getAttribute("data-date")),n=new Date-t;let i=n/4e3*100;e.querySelector(".expiry-span").style.width=100-i+"%",n>4e3&&e.remove()})),0===e.length&&(this.errorBlock.style.display="none"),window.requestAnimationFrame((()=>this.trackErrors()))}}},534:(e,t,n)=>{n.d(t,{W$:()=>s});var i=n(790),r=n(565);async function s(){let e=null,t=null,n=null;try{return t=r.KR(r.OO,"overallRanking"),e=await r.Jt(t),n=e.val(),n||[{username:"No players yet",points:0,time:0,startTime:0,gamePin:"N/A"}]}catch(e){if(!e.message.includes("offline"))throw i.v.errorDetection.consoleError("could not get overall ranking, try again!"),new Error(`could not get overall ranking\n\n ${e}`);return s(),console.error(e),n||[{username:"No players yet",points:0,time:0,startTime:0,gamePin:"N/A"}]}}},565:(e,t,n)=>{n.d(t,{OO:()=>Rd,Jt:()=>$o,KR:()=>Ho});const i=function(e,t){if(!e)throw r(t)},r=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},s=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=r>>2,h=(3&r)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==c)throw new a;const l=r<<2|s>>4;if(i.push(l),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==c){const e=o<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(e){const t=s(e);return o.encodeByteArray(t,!0)},l=function(e){return c(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return d(void 0,e)}function d(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=d(e[n],t[n]));return e}const p=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&h(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{var t,n;return null===(n=null===(t=p())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},m=e=>{const t=f(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},g=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config},_=e=>{var t;return null===(t=p())||void 0===t?void 0:t[`_${e}`]};class v{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function y(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(s)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function b(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function T(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function E(){try{return"object"==typeof indexedDB}catch(e){return!1}}function C(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function k(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,R.prototype.create)}}class R{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(N,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new S(i,o,n)}}const N=/\{\$([^}]+)}/g;function P(e){return JSON.parse(e)}function A(e){return JSON.stringify(e)}const O=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=P(h(s[0])||""),n=P(h(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}};function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function M(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function x(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function U(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(F(n)&&F(s)){if(!U(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function F(e){return null!==e&&"object"==typeof e}function q(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function j(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function B(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class W{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),r=1518500249):(i=o^a^c,r=1859775393):e<60?(i=o&a|c&(o|a),r=2400959708):(i=o^a^c,r=3395469782);const t=(s<<5|s>>>27)+i+l+r+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class H{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=V),void 0===i.error&&(i.error=V),void 0===i.complete&&(i.complete=V);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function V(){}function $(e,t){return`${e} failed: ${t} argument `}const z=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t},K=1e3,G=2,Y=144e5,J=.5;function Q(e,t=K,n=G){const i=t*Math.pow(n,e),r=Math.round(J*i*(Math.random()-.5)*2);return Math.min(Y,i+r)}function X(e){return e&&e._delegate?e._delegate:e}class Z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ee="[DEFAULT]";class te{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new v;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:ee})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=ee){return this.instances.has(e)}getOptions(e=ee){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===ee?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=ee){return this.component?this.component.multipleInstances?e:ee:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ne{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new te(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const ie=[];var re;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(re||(re={}));const se={debug:re.DEBUG,verbose:re.VERBOSE,info:re.INFO,warn:re.WARN,error:re.ERROR,silent:re.SILENT},oe=re.INFO,ae={[re.DEBUG]:"log",[re.VERBOSE]:"log",[re.INFO]:"info",[re.WARN]:"warn",[re.ERROR]:"error"},ce=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=ae[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class le{constructor(e){this.name=e,this._logLevel=oe,this._logHandler=ce,this._userLogHandler=null,ie.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in re))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?se[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,re.DEBUG,...e),this._logHandler(this,re.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,re.VERBOSE,...e),this._logHandler(this,re.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,re.INFO,...e),this._logHandler(this,re.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,re.WARN,...e),this._logHandler(this,re.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,re.ERROR,...e),this._logHandler(this,re.ERROR,...e)}}const he=(e,t)=>t.some((t=>e instanceof t));let ue,de;const pe=new WeakMap,fe=new WeakMap,me=new WeakMap,ge=new WeakMap,_e=new WeakMap;let ve={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return fe.get(e);if("objectStoreNames"===t)return e.objectStoreNames||me.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return we(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ye(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(de||(de=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Ie(this),e),we(pe.get(this))}:function(...e){return we(t.apply(Ie(this),e))}:function(e,...n){const i=t.call(Ie(this),e,...n);return me.set(i,e.sort?e.sort():[e]),we(i)}:(e instanceof IDBTransaction&&function(e){if(fe.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));fe.set(e,t)}(e),he(e,ue||(ue=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ve):e);var t}function we(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(we(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&pe.set(t,e)})).catch((()=>{})),_e.set(t,e),t}(e);if(ge.has(e))return ge.get(e);const t=ye(e);return t!==e&&(ge.set(e,t),_e.set(t,e)),t}const Ie=e=>_e.get(e);function be(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=we(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(we(o.result),e.oldVersion,e.newVersion,we(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const Te=["get","getKey","getAll","getAllKeys","count"],Ee=["put","add","delete","clear"],Ce=new Map;function ke(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ce.get(t))return Ce.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Ee.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Te.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return Ce.set(t,s),s}var Se;Se=ve,ve={...Se,get:(e,t,n)=>ke(e,t)||Se.get(e,t,n),has:(e,t)=>!!ke(e,t)||Se.has(e,t)};class Re{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Ne="@firebase/app",Pe="0.10.7",Ae=new le("@firebase/app"),Oe="@firebase/app-compat",De="@firebase/analytics-compat",Le="@firebase/analytics",Me="@firebase/app-check-compat",xe="@firebase/app-check",Ue="@firebase/auth",Fe="@firebase/auth-compat",qe="@firebase/database",je="@firebase/database-compat",Be="@firebase/functions",We="@firebase/functions-compat",He="@firebase/installations",Ve="@firebase/installations-compat",$e="@firebase/messaging",ze="@firebase/messaging-compat",Ke="@firebase/performance",Ge="@firebase/performance-compat",Ye="@firebase/remote-config",Je="@firebase/remote-config-compat",Qe="@firebase/storage",Xe="@firebase/storage-compat",Ze="@firebase/firestore",et="@firebase/vertexai-preview",tt="@firebase/firestore-compat",nt="firebase",it="[DEFAULT]",rt={[Ne]:"fire-core",[Oe]:"fire-core-compat",[Le]:"fire-analytics",[De]:"fire-analytics-compat",[xe]:"fire-app-check",[Me]:"fire-app-check-compat",[Ue]:"fire-auth",[Fe]:"fire-auth-compat",[qe]:"fire-rtdb",[je]:"fire-rtdb-compat",[Be]:"fire-fn",[We]:"fire-fn-compat",[He]:"fire-iid",[Ve]:"fire-iid-compat",[$e]:"fire-fcm",[ze]:"fire-fcm-compat",[Ke]:"fire-perf",[Ge]:"fire-perf-compat",[Ye]:"fire-rc",[Je]:"fire-rc-compat",[Qe]:"fire-gcs",[Xe]:"fire-gcs-compat",[Ze]:"fire-fst",[tt]:"fire-fst-compat",[et]:"fire-vertex","fire-js":"fire-js",[nt]:"fire-js-all"},st=new Map,ot=new Map,at=new Map;function ct(e,t){try{e.container.addComponent(t)}catch(n){Ae.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function lt(e){const t=e.name;if(at.has(t))return Ae.debug(`There were multiple attempts to register component ${t}.`),!1;at.set(t,e);for(const t of st.values())ct(t,e);for(const t of ot.values())ct(t,e);return!0}function ht(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ut(e){return void 0!==e.settings}const dt=new R("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class pt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Z("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw dt.create("app-deleted",{appName:this._name})}}const ft="10.12.4";function mt(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:it,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw dt.create("bad-app-name",{appName:String(r)});if(n||(n=g()),!n)throw dt.create("no-options");const s=st.get(r);if(s){if(U(n,s.options)&&U(i,s.config))return s;throw dt.create("duplicate-app",{appName:r})}const o=new ne(r);for(const e of at.values())o.addComponent(e);const a=new pt(n,i,o);return st.set(r,a),a}function gt(e=it){const t=st.get(e);if(!t&&e===it&&g())return mt();if(!t)throw dt.create("no-app",{appName:e});return t}function _t(e,t,n){var i;let r=null!==(i=rt[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ae.warn(e.join(" "))}lt(new Z(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const vt="firebase-heartbeat-database",yt=1,wt="firebase-heartbeat-store";let It=null;function bt(){return It||(It=be(vt,yt,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(wt)}catch(e){console.warn(e)}}}).catch((e=>{throw dt.create("idb-open",{originalErrorMessage:e.message})}))),It}async function Tt(e,t){try{const n=(await bt()).transaction(wt,"readwrite"),i=n.objectStore(wt);await i.put(t,Et(e)),await n.done}catch(e){if(e instanceof S)Ae.warn(e.message);else{const t=dt.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Ae.warn(t.message)}}}function Et(e){return`${e.name}!${e.options.appId}`}class Ct{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new St(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=kt();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==i&&!this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=kt(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Rt(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Rt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=l(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function kt(){return(new Date).toISOString().substring(0,10)}class St{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!E()&&C().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await bt()).transaction(wt),n=await t.objectStore(wt).get(Et(e));return await t.done,n}catch(e){if(e instanceof S)Ae.warn(e.message);else{const t=dt.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Ae.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Tt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Tt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Rt(e){return l(JSON.stringify({version:2,heartbeats:e})).length}lt(new Z("platform-logger",(e=>new Re(e)),"PRIVATE")),lt(new Z("heartbeat",(e=>new Ct(e)),"PRIVATE")),_t(Ne,Pe,""),_t(Ne,Pe,"esm2017"),_t("fire-js",""),_t("firebase","10.12.4","app");const Nt="firebasestorage.googleapis.com";class Pt extends S{constructor(e,t,n=0){super(Dt(e),`Firebase Storage: ${t} (${Dt(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Pt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Dt(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var At,Ot;function Dt(e){return"storage/"+e}function Lt(e){return new Pt(At.INVALID_ARGUMENT,e)}function Mt(){return new Pt(At.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(At||(At={}));class xt{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=xt.makeFromUrl(e,t)}catch(t){return new xt(e,"")}if(""===n.path)return n;throw i=e,new Pt(At.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Nt?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const i=a[t],r=i.regex.exec(e);if(r){const e=r[i.indices.bucket];let t=r[i.indices.path];t||(t=""),n=new xt(e,t),i.postModify(n);break}}if(null==n)throw function(e){return new Pt(At.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Ut{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Ft(e,t,n,i){if(i<t)throw Lt(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw Lt(`Invalid value for '${e}'. Expected ${n} or less.`)}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Ot||(Ot={}));class qt{constructor(e,t,n,i,r,s,o,a,c,l,h,u=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,i=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0!==e?n(e):n()}catch(e){i(e)}else if(null!==r){const e=new Pt(At.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,e)):i(e)}else t.canceled?i(this.appDelete_?Mt():new Pt(At.CANCELED,"User canceled the upload/download.")):i(new Pt(At.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new jt(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,r=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){r=setTimeout((()=>{r=null,e(p,c())}),t)}function d(){s&&clearTimeout(s)}function p(e,...t){if(l)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),u(n)}let f=!1;function m(e){f||(f=!0,d(),l||(null!==r?(e||(a=2),clearTimeout(r),u(0)):e||(a=1)))}return u(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(((e,t)=>{if(t)return void e(!1,new jt(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===Ot.NO_ERROR,r=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||i||r}(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Ot.ABORT;return void e(!1,new jt(!1,null,t))}const s=-1!==this.successCodes_.indexOf(r);e(!0,new jt(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class jt{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class Bt{constructor(e,t){this._service=e,this._location=t instanceof xt?t:xt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Bt(e,t)}get root(){const e=new xt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new xt(this._location.bucket,e);return new Bt(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Pt(At.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Wt(e,t){const n=null==t?void 0:t.storageBucket;return null==n?null:xt.makeFromBucketSpec(n,e)}class Ht{constructor(e,t,n,i,r){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=Nt,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?xt.makeFromBucketSpec(i,this._host):Wt(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=xt.makeFromBucketSpec(this._url,e):this._bucket=Wt(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ft("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ft("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Bt(this,e)}_makeRequest(e,t,n,i,r=!0){if(this._deleted)return new Ut(Mt());{const s=function(e,t,n,i,r,s,o=!0){const a=function(e){const t=encodeURIComponent;let n="?";for(const i in e)e.hasOwnProperty(i)&&(n=n+(t(i)+"=")+t(e[i])+"&");return n=n.slice(0,-1),n}(e.urlParams),c=e.url+a,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(l,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,i),new qt(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,o)}(e,this._appId,n,i,t,this._firebaseVersion,r);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const Vt="@firebase/storage",$t="0.12.6",zt="storage";lt(new Z(zt,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new Ht(n,i,r,t,ft)}),"PUBLIC").setMultipleInstances(!0)),_t(Vt,$t,""),_t(Vt,$t,"esm2017");const Kt="@firebase/database",Gt="1.0.6";let Yt="";class Jt{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),A(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:P(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Qt{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return D(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Xt=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Jt(t)}}catch(e){}return new Qt},Zt=Xt("localStorage"),en=Xt("sessionStorage"),tn=new le("@firebase/database"),nn=function(){let e=1;return function(){return e++}}(),rn=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s>=55296&&s<=56319){const t=s-55296;r++,i(r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(r)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t}(e),n=new W;n.update(t);const r=n.digest();return o.encodeByteArray(r)},sn=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=sn.apply(null,i):t+="object"==typeof i?A(i):i,t+=" "}return t};let on=null,an=!0;const cn=function(...e){if(!0===an&&(an=!1,null===on&&!0===en.get("logging_enabled")&&(t=!0,i(!n||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(tn.logLevel=re.VERBOSE,on=tn.log.bind(tn),n&&en.set("logging_enabled",!0)):"function"==typeof t?on=t:(on=null,en.remove("logging_enabled")))),on){const t=sn.apply(null,e);on(t)}var t,n},ln=function(e){return function(...t){cn(e,...t)}},hn=function(...e){const t="FIREBASE INTERNAL ERROR: "+sn(...e);tn.error(t)},un=function(...e){const t=`FIREBASE FATAL ERROR: ${sn(...e)}`;throw tn.error(t),new Error(t)},dn=function(...e){const t="FIREBASE WARNING: "+sn(...e);tn.warn(t)},pn=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},fn="[MIN_NAME]",mn="[MAX_NAME]",gn=function(e,t){if(e===t)return 0;if(e===fn||t===mn)return-1;if(t===fn||e===mn)return 1;{const n=En(e),i=En(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},_n=function(e,t){return e===t?0:e<t?-1:1},vn=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+A(t))},yn=function(e){if("object"!=typeof e||null===e)return A(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=A(t[i]),n+=":",n+=yn(e[t[i]]);return n+="}",n},wn=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function In(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const bn=function(e){i(!pn(e),"Invalid JSON number");let t,n,r,s,o;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=s+1023,r=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},Tn=new RegExp("^-?(0*)\\d{1,10}$"),En=function(e){if(Tn.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Cn=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw dn("Exception was thrown by user callback.",t),e}),Math.floor(0))}},kn=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class Sn{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){dn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Rn{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(cn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',dn(e)}}class Nn{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Nn.OWNER="owner";const Pn="5",An=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,On="ac",Dn="websocket",Ln="long_polling";class Mn{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Zt.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Zt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function xn(e,t,n){let r;if(i("string"==typeof t,"typeof type must == string"),i("object"==typeof n,"typeof params must == object"),t===Dn)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Ln)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return In(n,((e,t)=>{s.push(e+"="+t)})),r+s.join("&")}class Un{constructor(){this.counters_={}}incrementCounter(e,t=1){D(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const Fn={},qn={};function jn(e){const t=e.toString();return Fn[t]||(Fn[t]=new Un),Fn[t]}class Bn{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Cn((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Wn="start";class Hn{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ln(e),this.stats_=jn(t),this.urlFn=e=>(this.appCheckToken&&(e[On]=this.appCheckToken),xn(t,Ln,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Bn(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Vn(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Wn)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Wn]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Pn,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[On]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&An.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Hn.forceAllow_=!0}static forceDisallow(){Hn.forceDisallow_=!0}static isAvailable(){return!(!Hn.forceAllow_&&(Hn.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=A(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=c(t),i=wn(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=A(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Vn{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=nn(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Vn.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){cn("frame writing exception"),e.stack&&cn(e.stack),cn(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||cn("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{cn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let $n=null;"undefined"!=typeof MozWebSocket?$n=MozWebSocket:"undefined"!=typeof WebSocket&&($n=WebSocket);class zn{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ln(this.connId),this.stats_=jn(t),this.connURL=zn.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const s={};return s.v=Pn,"undefined"!=typeof location&&location.hostname&&An.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s[On]=i),r&&(s.p=r),xn(e,Dn,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Zt.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new $n(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){zn.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==$n&&!zn.forceDisallow_}static previouslyFailed(){return Zt.isInMemoryStorage||!0===Zt.get("previous_websocket_failure")}markConnectionHealthy(){Zt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=P(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(i(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=A(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=wn(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}zn.responsesRequiredToBeHealthy=2,zn.healthyTimeout=3e4;class Kn{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Hn,zn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=zn&&zn.isAvailable();let n=t&&!zn.previouslyFailed();if(e.webSocketOnly&&(t||dn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[zn];else{const e=this.transports_=[];for(const t of Kn.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Kn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Kn.globalTransportInitialized_=!1;class Gn{constructor(e,t,n,i,r,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ln("c:"+this.id+":"),this.transportManager_=new Kn(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=kn((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=vn("t",e),n=vn("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=vn("t",e),n=vn("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=vn("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?hn("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):hn("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Pn!==n&&dn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),kn((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kn((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Zt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Yn{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Jn{constructor(e){this.allowedEvents_=e,this.listeners_={},i(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){i(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class Qn extends Jn{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||I()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Qn}getInitialEvent(e){return i("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Xn{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Zn(){return new Xn("")}function ei(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ti(e){return e.pieces_.length-e.pieceNum_}function ni(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Xn(e.pieces_,t)}function ii(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function ri(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function si(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Xn(t,0)}function oi(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Xn)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Xn(n,0)}function ai(e){return e.pieceNum_>=e.pieces_.length}function ci(e,t){const n=ei(e),i=ei(t);if(null===n)return t;if(n===i)return ci(ni(e),ni(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function li(e,t){if(ti(e)!==ti(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function hi(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(ti(e)>ti(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class ui{constructor(e,t){this.errorPrefix_=t,this.parts_=ri(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=z(this.parts_[e]);di(this)}}function di(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+pi(e))}function pi(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class fi extends Jn{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new fi}getInitialEvent(e){return i("visible"===e,"Unknown event type: "+e),[this.visible_]}}const mi=1e3;class gi extends Yn{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=gi.nextPersistentConnectionId_++,this.log_=ln("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=mi,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");fi.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Qn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(A(s)),i(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new v,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),i(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;gi.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&D(e,"w")){const n=L(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();dn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=O(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=O(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+A(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):hn("Unrecognized action received from server: "+A(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){i(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=mi,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=mi,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=mi),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+gi.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},l=function(e){i(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[i,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?cn("getToken() completed but was canceled"):(cn("getToken() completed. Creating connection."),this.authToken_=i&&i.accessToken,this.appCheckToken_=c&&c.token,a=new Gn(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{dn(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&dn(e),c())}}}interrupt(e){cn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){cn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],M(this.interruptReasons_)&&(this.reconnectDelay_=mi,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>yn(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new Xn(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){cn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){cn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Yt.replace(/\./g,"-")]=1,I()?e["framework.cordova"]=1:T()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Qn.getInstance().currentlyOnline();return M(this.interruptReasons_)&&e}}gi.nextPersistentConnectionId_=0,gi.nextConnectionId_=0;class _i{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new _i(e,t)}}class vi{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new _i(fn,e),i=new _i(fn,t);return 0!==this.compare(n,i)}minPost(){return _i.MIN}}let yi;class wi extends vi{static get __EMPTY_NODE(){return yi}static set __EMPTY_NODE(e){yi=e}compare(e,t){return gn(e.name,t.name)}isDefinedOn(e){throw r("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return _i.MIN}maxPost(){return new _i(mn,yi)}makePost(e,t){return i("string"==typeof e,"KeyIndex indexValue must always be a string."),new _i(e,yi)}toString(){return".key"}}const Ii=new wi;class bi{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ti{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Ti.RED,this.left=null!=i?i:Ei.EMPTY_NODE,this.right=null!=r?r:Ei.EMPTY_NODE}copy(e,t,n,i,r){return new Ti(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ei.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ei.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ti.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ti.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ti.RED=!0,Ti.BLACK=!1;class Ei{constructor(e,t=Ei.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ei(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ti.BLACK,null,null))}remove(e){return new Ei(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ti.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bi(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bi(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bi(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bi(this.root_,null,this.comparator_,!0,e)}}function Ci(e,t){return gn(e.name,t.name)}function ki(e,t){return gn(e,t)}let Si;Ei.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new Ti(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Ri=function(e){return"number"==typeof e?"number:"+bn(e):"string:"+e},Ni=function(e){if(e.isLeafNode()){const t=e.val();i("string"==typeof t||"number"==typeof t||"object"==typeof t&&D(t,".sv"),"Priority must be a string or number.")}else i(e===Si||e.isEmpty(),"priority of unexpected type.");i(e===Si||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Pi,Ai,Oi;class Di{constructor(e,t=Di.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,i(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ni(this.priorityNode_)}static set __childrenNodeConstructor(e){Pi=e}static get __childrenNodeConstructor(){return Pi}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Di(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Di.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ai(e)?this:".priority"===ei(e)?this.priorityNode_:Di.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Di.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=ei(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(i(".priority"!==n||1===ti(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Di.__childrenNodeConstructor.EMPTY_NODE.updateChild(ni(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ri(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?bn(this.value_):this.value_,this.lazyHash_=rn(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Di.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Di.__childrenNodeConstructor?-1:(i(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=Di.VALUE_TYPE_ORDER.indexOf(t),s=Di.VALUE_TYPE_ORDER.indexOf(n);return i(r>=0,"Unknown leaf type: "+t),i(s>=0,"Unknown leaf type: "+n),r===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Di.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Li=new class extends vi{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?gn(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return _i.MIN}maxPost(){return new _i(mn,new Di("[PRIORITY-POST]",Oi))}makePost(e,t){const n=Ai(e);return new _i(t,new Di("[PRIORITY-POST]",n))}toString(){return".priority"}},Mi=Math.log(2);class xi{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Mi,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ui=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Ti(a,o.node,Ti.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=r(t,c),h=r(c+1,i);return o=e[c],a=n?n(o):o,new Ti(a,o.node,Ti.BLACK,l,h)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const l=r(s+1,a),h=e[s],u=n?n(h):h;c(new Ti(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Ti.BLACK):(a(i,Ti.BLACK),a(i,Ti.RED))}return s}(new xi(e.length));return new Ei(i||t,s)};let Fi;const qi={};class ji{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return i(qi&&Li,"ChildrenNode.ts has not been loaded"),Fi=Fi||new ji({".priority":qi},{".priority":Li}),Fi}get(e){const t=L(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ei?t:null}hasIndex(e){return D(this.indexSet_,e.toString())}addIndex(e,t){i(e!==Ii,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const s=t.getIterator(_i.Wrap);let o,a=s.getNext();for(;a;)r=r||e.isDefinedOn(a.node),n.push(a),a=s.getNext();o=r?Ui(n,e.getCompare()):qi;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new ji(h,l)}addToIndexes(e,t){const n=x(this.indexes_,((n,r)=>{const s=L(this.indexSet_,r);if(i(s,"Missing index implementation for "+r),n===qi){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(_i.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),Ui(n,s.getCompare())}return qi}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new _i(e.name,i))),r.insert(e,e.node)}}));return new ji(n,this.indexSet_)}removeFromIndexes(e,t){const n=x(this.indexes_,(n=>{if(n===qi)return n;{const i=t.get(e.name);return i?n.remove(new _i(e.name,i)):n}}));return new ji(n,this.indexSet_)}}let Bi;class Wi{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ni(this.priorityNode_),this.children_.isEmpty()&&i(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Bi||(Bi=new Wi(new Ei(ki),null,ji.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Bi}updatePriority(e){return this.children_.isEmpty()?this:new Wi(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Bi:t}}getChild(e){const t=ei(e);return null===t?this:this.getImmediateChild(t).getChild(ni(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(i(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new _i(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?Bi:this.priorityNode_;return new Wi(i,s,r)}}updateChild(e,t){const n=ei(e);if(null===n)return t;{i(".priority"!==ei(e)||1===ti(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(ni(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(Li,((s,o)=>{t[s]=o.val(e),n++,r&&Wi.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Ri(this.getPriority().val())+":"),this.forEachChild(Li,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":rn(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new _i(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new _i(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new _i(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,_i.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,_i.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Hi?-1:0}withIndex(e){if(e===Ii||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Wi(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ii||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Li),n=t.getIterator(Li);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===Ii?null:this.indexMap_.get(e.toString())}}Wi.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Hi=new class extends Wi{constructor(){super(new Ei(ki),Wi.EMPTY_NODE,ji.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Wi.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(_i,{MIN:{value:new _i(fn,Wi.EMPTY_NODE)},MAX:{value:new _i(mn,Hi)}}),wi.__EMPTY_NODE=Wi.EMPTY_NODE,Di.__childrenNodeConstructor=Wi,Si=Hi,Oi=Hi;const Vi=!0;function $i(e,t=null){if(null===e)return Wi.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),i(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Di(e,$i(t));if(e instanceof Array||!Vi){let n=Wi.EMPTY_NODE;return In(e,((t,i)=>{if(D(e,t)&&"."!==t.substring(0,1)){const e=$i(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority($i(t))}{const n=[];let i=!1;if(In(e,((e,t)=>{if("."!==e.substring(0,1)){const r=$i(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new _i(e,r)))}})),0===n.length)return Wi.EMPTY_NODE;const r=Ui(n,Ci,(e=>e.name),ki);if(i){const e=Ui(n,Li.getCompare());return new Wi(r,$i(t),new ji({".priority":e},{".priority":Li}))}return new Wi(r,$i(t),ji.Default)}}!function(e){Ai=e}($i);class zi extends vi{constructor(e){super(),this.indexPath_=e,i(!ai(e)&&".priority"!==ei(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?gn(e.name,t.name):r}makePost(e,t){const n=$i(e),i=Wi.EMPTY_NODE.updateChild(this.indexPath_,n);return new _i(t,i)}maxPost(){const e=Wi.EMPTY_NODE.updateChild(this.indexPath_,Hi);return new _i(mn,e)}toString(){return ri(this.indexPath_,0).join("/")}}const Ki=new class extends vi{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?gn(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return _i.MIN}maxPost(){return _i.MAX}makePost(e,t){const n=$i(e);return new _i(t,n)}toString(){return".value"}};function Gi(e){return{type:"value",snapshotNode:e}}function Yi(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ji(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Qi(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Xi{constructor(e){this.index_=e}updateChild(e,t,n,r,s,o){i(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Ji(t,a)):i(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Yi(t,n)):o.trackChildChange(Qi(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Li,((e,i)=>{t.hasChild(e)||n.trackChildChange(Ji(e,i))})),t.isLeafNode()||t.forEachChild(Li,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(Qi(t,i,r))}else n.trackChildChange(Yi(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Wi.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Zi{constructor(e){this.indexedFilter_=new Xi(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Zi.getStartPost_(e),this.endPost_=Zi.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new _i(t,n))||(n=Wi.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Wi.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Wi.EMPTY_NODE);const r=this;return t.forEachChild(Li,((e,t)=>{r.matches(new _i(e,t))||(i=i.updateImmediateChild(e,Wi.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class er{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Zi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new _i(t,n))||(n=Wi.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=Wi.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=Wi.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(Wi.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,Wi.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,s){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;i(a.numChildren()===this.limit_,"");const c=new _i(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let i=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=i&&(i.name===t||a.hasChild(i.name));)i=r.getChildAfterChild(this.index_,i,this.reverse_);const u=null==i?1:o(i,c);if(h&&!n.isEmpty()&&u>=0)return null!=s&&s.trackChildChange(Qi(t,n,e)),a.updateImmediateChild(t,n);{null!=s&&s.trackChildChange(Ji(t,e));const n=a.updateImmediateChild(t,Wi.EMPTY_NODE);return null!=i&&this.rangedFilter_.matches(i)?(null!=s&&s.trackChildChange(Yi(i.name,i.node)),n.updateImmediateChild(i.name,i.node)):n}}return n.isEmpty()?e:h&&o(l,c)>=0?(null!=s&&(s.trackChildChange(Ji(l.name,l.node)),s.trackChildChange(Yi(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,Wi.EMPTY_NODE)):e}}class tr{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Li}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return i(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return i(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fn}hasEnd(){return this.endSet_}getIndexEndValue(){return i(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return i(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:mn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return i(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Li}copy(){const e=new tr;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function nr(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Li?n="$priority":e.index_===Ki?n="$value":e.index_===Ii?n="$key":(i(e.index_ instanceof zi,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=A(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=A(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+A(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=A(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+A(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function ir(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Li&&(t.i=e.index_.toString()),t}class rr extends Yn{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=ln("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(i(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const s=rr.getListenId_(e,n),o={};this.listens_[s]=o;const a=nr(e._queryParams);this.restRequest_(r+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),L(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=rr.getListenId_(e,t);delete this.listens_[n]}get(e){const t=nr(e._queryParams),n=e._path.toString(),i=new v;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+q(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=P(o.responseText)}catch(e){dn("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&dn("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class sr{constructor(){this.rootNode_=Wi.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function or(){return{value:null,children:new Map}}function ar(e,t,n){if(ai(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=ei(t);e.children.has(i)||e.children.set(i,or()),ar(e.children.get(i),t=ni(t),n)}}function cr(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{cr(i,new Xn(t.toString()+"/"+e),n)}))}class lr{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&In(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class hr{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new lr(e);const n=1e4+2e4*Math.random();kn(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;In(e,((e,i)=>{i>0&&D(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),kn(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var ur;function dr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ur||(ur={}));class pr{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ur.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(ai(this.path)){if(null!=this.affectedTree.value)return i(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Xn(e));return new pr(Zn(),t,this.revert)}}return i(ei(this.path)===e,"operationForChild called for unrelated child."),new pr(ni(this.path),this.affectedTree,this.revert)}}class fr{constructor(e,t){this.source=e,this.path=t,this.type=ur.LISTEN_COMPLETE}operationForChild(e){return ai(this.path)?new fr(this.source,Zn()):new fr(this.source,ni(this.path))}}class mr{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ur.OVERWRITE}operationForChild(e){return ai(this.path)?new mr(this.source,Zn(),this.snap.getImmediateChild(e)):new mr(this.source,ni(this.path),this.snap)}}class gr{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ur.MERGE}operationForChild(e){if(ai(this.path)){const t=this.children.subtree(new Xn(e));return t.isEmpty()?null:t.value?new mr(this.source,Zn(),t.value):new gr(this.source,Zn(),t)}return i(ei(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new gr(this.source,ni(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class _r{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ai(e))return this.isFullyInitialized()&&!this.filtered_;const t=ei(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class vr{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function yr(e,t,n,i,s,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw r("Should only compare child_ events.");const i=new _i(t.childName,t.snapshotNode),s=new _i(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);s.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function wr(e,t){return{eventCache:e,serverCache:t}}function Ir(e,t,n,i){return wr(new _r(t,n,i),e.serverCache)}function br(e,t,n,i){return wr(e.eventCache,new _r(t,n,i))}function Tr(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Er(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Cr;class kr{constructor(e,t=(()=>(Cr||(Cr=new Ei(_n)),Cr))()){this.value=e,this.children=t}static fromObject(e){let t=new kr(null);return In(e,((e,n)=>{t=t.set(new Xn(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Zn(),value:this.value};if(ai(e))return null;{const n=ei(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(ni(e),t);return null!=r?{path:oi(new Xn(n),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(ai(e))return this;{const t=ei(e),n=this.children.get(t);return null!==n?n.subtree(ni(e)):new kr(null)}}set(e,t){if(ai(e))return new kr(t,this.children);{const n=ei(e),i=(this.children.get(n)||new kr(null)).set(ni(e),t),r=this.children.insert(n,i);return new kr(this.value,r)}}remove(e){if(ai(e))return this.children.isEmpty()?new kr(null):new kr(null,this.children);{const t=ei(e),n=this.children.get(t);if(n){const i=n.remove(ni(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new kr(null):new kr(this.value,r)}return this}}get(e){if(ai(e))return this.value;{const t=ei(e),n=this.children.get(t);return n?n.get(ni(e)):null}}setTree(e,t){if(ai(e))return t;{const n=ei(e),i=(this.children.get(n)||new kr(null)).setTree(ni(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new kr(this.value,r)}}fold(e){return this.fold_(Zn(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(oi(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Zn(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(ai(e))return null;{const i=ei(e),r=this.children.get(i);return r?r.findOnPath_(ni(e),oi(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Zn(),t)}foreachOnPath_(e,t,n){if(ai(e))return this;{this.value&&n(t,this.value);const i=ei(e),r=this.children.get(i);return r?r.foreachOnPath_(ni(e),oi(t,i),n):new kr(null)}}foreach(e){this.foreach_(Zn(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(oi(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Sr{constructor(e){this.writeTree_=e}static empty(){return new Sr(new kr(null))}}function Rr(e,t,n){if(ai(t))return new Sr(new kr(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=ci(r,t);return s=s.updateChild(o,n),new Sr(e.writeTree_.set(r,s))}{const i=new kr(n),r=e.writeTree_.setTree(t,i);return new Sr(r)}}}function Nr(e,t,n){let i=e;return In(n,((e,n)=>{i=Rr(i,oi(t,e),n)})),i}function Pr(e,t){if(ai(t))return Sr.empty();{const n=e.writeTree_.setTree(t,new kr(null));return new Sr(n)}}function Ar(e,t){return null!=Or(e,t)}function Or(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(ci(n.path,t)):null}function Dr(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Li,((e,n)=>{t.push(new _i(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new _i(e,n.value))})),t}function Lr(e,t){if(ai(t))return e;{const n=Or(e,t);return new Sr(null!=n?new kr(n):e.writeTree_.subtree(t))}}function Mr(e){return e.writeTree_.isEmpty()}function xr(e,t){return Ur(Zn(),e.writeTree_,t)}function Ur(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(i(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):n=Ur(oi(e,t),s,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(oi(e,".priority"),r)),n}}function Fr(e,t){return Yr(t,e)}function qr(e,t){if(e.snap)return hi(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&hi(oi(e.path,n),t))return!0;return!1}function jr(e){return e.visible}function Br(e,t,n){let i=Sr.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){const e=o.path;let t;if(o.snap)hi(n,e)?(t=ci(n,e),i=Rr(i,t,o.snap)):hi(e,n)&&(t=ci(e,n),i=Rr(i,Zn(),o.snap.getChild(t)));else{if(!o.children)throw r("WriteRecord should have .snap or .children");if(hi(n,e))t=ci(n,e),i=Nr(i,t,o.children);else if(hi(e,n))if(t=ci(e,n),ai(t))i=Nr(i,Zn(),o.children);else{const e=L(o.children,ei(t));if(e){const n=e.getChild(ni(t));i=Rr(i,Zn(),n)}}}}}return i}function Wr(e,t,n,i,r){if(i||r){const s=Lr(e.visibleWrites,t);if(!r&&Mr(s))return n;if(r||null!=n||Ar(s,Zn())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(hi(e.path,t)||hi(t,e.path))};return xr(Br(e.allWrites,s,t),n||Wi.EMPTY_NODE)}return null}{const i=Or(e.visibleWrites,t);if(null!=i)return i;{const i=Lr(e.visibleWrites,t);return Mr(i)?n:null!=n||Ar(i,Zn())?xr(i,n||Wi.EMPTY_NODE):null}}}function Hr(e,t,n,i){return Wr(e.writeTree,e.treePath,t,n,i)}function Vr(e,t){return function(e,t,n){let i=Wi.EMPTY_NODE;const r=Or(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Li,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=Lr(e.visibleWrites,t);return n.forEachChild(Li,((e,t)=>{const n=xr(Lr(r,new Xn(e)),t);i=i.updateImmediateChild(e,n)})),Dr(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Dr(Lr(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function $r(e,t,n,r){return function(e,t,n,r,s){i(r||s,"Either existingEventSnap or existingServerSnap must exist");const o=oi(t,n);if(Ar(e.visibleWrites,o))return null;{const t=Lr(e.visibleWrites,o);return Mr(t)?s.getChild(n):xr(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function zr(e,t){return function(e,t){return Or(e.visibleWrites,t)}(e.writeTree,oi(e.treePath,t))}function Kr(e,t,n){return function(e,t,n,i){const r=oi(t,n),s=Or(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?xr(Lr(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Gr(e,t){return Yr(oi(e.treePath,t),e.writeTree)}function Yr(e,t){return{treePath:e,writeTree:t}}class Jr{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;i("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),i(".priority"!==n,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(n);if(s){const i=s.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Qi(n,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Ji(n,s.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Yi(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw r("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(n,Qi(n,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Qr=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Xr{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new _r(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Kr(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Er(this.viewCache_),r=function(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const c=Lr(e.visibleWrites,t),l=Or(c,Zn());if(null!=l)a=l;else{if(null==n)return[];a=xr(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function Zr(e,t,n,r,s,o){const a=t.eventCache;if(null!=zr(r,n))return t;{let c,l;if(ai(n))if(i(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Er(t),i=Vr(r,n instanceof Wi?n:Wi.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=Hr(r,Er(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=ei(n);if(".priority"===h){i(1===ti(n),"Can't have a priority with additional path components");const s=a.getNode();l=t.serverCache.getNode();const o=$r(r,n,s,l);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const i=ni(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=$r(r,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(i,e):a.getNode().getImmediateChild(h)}else u=Kr(r,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,i,s,o):a.getNode()}}return Ir(t,c,a.isFullyInitialized()||ai(n),e.filter.filtersNodes())}}function es(e,t,n,i,r,s,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(ai(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=ei(n);if(!c.isCompleteForPath(n)&&ti(n)>1)return t;const r=ni(n),s=c.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?h.updatePriority(c.getNode(),s):h.updateChild(c.getNode(),e,s,r,Qr,null)}const u=br(t,l,c.isFullyInitialized()||ai(n),h.filtersNodes());return Zr(e,u,n,r,new Xr(r,u,s),a)}function ts(e,t,n,i,r,s,o){const a=t.eventCache;let c,l;const h=new Xr(r,t,s);if(ai(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=Ir(t,l,!0,e.filter.filtersNodes());else{const r=ei(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=Ir(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=ni(n),l=a.getNode().getImmediateChild(r);let u;if(ai(s))u=i;else{const e=h.getCompleteChild(r);u=null!=e?".priority"===ii(s)&&e.getChild(si(s)).isEmpty()?e:e.updateChild(s,i):Wi.EMPTY_NODE}c=l.equals(u)?t:Ir(t,e.filter.updateChild(a.getNode(),r,u,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function ns(e,t){return e.eventCache.isCompleteForChild(t)}function is(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function rs(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=ai(n)?i:new kr(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=is(0,t.serverCache.getNode().getImmediateChild(n),i);l=es(e,l,new Xn(n),c,r,s,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=is(0,t.serverCache.getNode().getImmediateChild(n),i);l=es(e,l,new Xn(n),c,r,s,o,a)}})),l}class ss{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Xi(n.getIndex()),r=(s=n).loadsAllData()?new Xi(s.getIndex()):s.hasLimit()?new er(s):new Zi(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(Wi.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(Wi.EMPTY_NODE,a.getNode(),null),h=new _r(c,o.isFullyInitialized(),i.filtersNodes()),u=new _r(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=wr(u,h),this.eventGenerator_=new vr(this.query_)}get query(){return this.query_}}function os(e,t){const n=Er(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!ai(t)&&!n.getImmediateChild(ei(t)).isEmpty())?n.getChild(t):null}function as(e){return 0===e.eventRegistrations_.length}function cs(e,t,n){const r=[];if(n){i(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,s);t&&r.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function ls(e,t,n,s){t.type===ur.MERGE&&null!==t.source.queryId&&(i(Er(e.viewCache_),"We should always have a full cache before handling merges"),i(Tr(e.viewCache_),"Missing event cache, even though we have a server cache"));const o=e.viewCache_,a=function(e,t,n,s,o){const a=new Jr;let c,l;if(n.type===ur.OVERWRITE){const r=n;r.source.fromUser?c=ts(e,t,r.path,r.snap,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered()&&!ai(r.path),c=es(e,t,r.path,r.snap,s,o,l,a))}else if(n.type===ur.MERGE){const r=n;r.source.fromUser?c=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,c)=>{const l=oi(n,i);ns(t,ei(l))&&(a=ts(e,a,l,c,r,s,o))})),i.foreach(((i,c)=>{const l=oi(n,i);ns(t,ei(l))||(a=ts(e,a,l,c,r,s,o))})),a}(e,t,r.path,r.children,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered(),c=rs(e,t,r.path,r.children,s,o,l,a))}else if(n.type===ur.ACK_USER_WRITE){const r=n;c=r.revert?function(e,t,n,r,s,o){let a;if(null!=zr(r,n))return t;{const c=new Xr(r,t,s),l=t.eventCache.getNode();let h;if(ai(n)||".priority"===ei(n)){let n;if(t.serverCache.isFullyInitialized())n=Hr(r,Er(t));else{const e=t.serverCache.getNode();i(e instanceof Wi,"serverChildren would be complete if leaf node"),n=Vr(r,e)}h=e.filter.updateFullNode(l,n,o)}else{const i=ei(n);let s=Kr(r,i,t.serverCache);null==s&&t.serverCache.isCompleteForChild(i)&&(s=l.getImmediateChild(i)),h=null!=s?e.filter.updateChild(l,i,s,ni(n),c,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,Wi.EMPTY_NODE,ni(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=Hr(r,Er(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=zr(r,Zn()),Ir(t,h,a,e.filter.filtersNodes())}}(e,t,r.path,s,o,a):function(e,t,n,i,r,s,o){if(null!=zr(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(ai(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return es(e,t,n,c.getNode().getChild(n),r,s,a,o);if(ai(n)){let i=new kr(null);return c.getNode().forEachChild(Ii,((e,t)=>{i=i.set(new Xn(e),t)})),rs(e,t,n,i,r,s,a,o)}return t}{let l=new kr(null);return i.foreach(((e,t)=>{const i=oi(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),rs(e,t,n,l,r,s,a,o)}}(e,t,r.path,r.affectedTree,s,o,a)}else{if(n.type!==ur.LISTEN_COMPLETE)throw r("Unknown operation type: "+n.type);c=function(e,t,n,i,r){const s=t.serverCache;return Zr(e,br(t,s.getNode(),s.isFullyInitialized()||ai(n),s.isFiltered()),n,i,Qr,r)}(e,t,n.path,s,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Tr(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(Gi(Tr(t)))}}(t,c,h),{viewCache:c,changes:h}}(e.processor_,o,t,n,s);var c,l;return c=e.processor_,l=a.viewCache,i(l.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),i(l.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),i(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,hs(e,a.changes,a.viewCache.eventCache.getNode(),null)}function hs(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),yr(e,r,"child_removed",t,i,n),yr(e,r,"child_added",t,i,n),yr(e,r,"child_moved",s,i,n),yr(e,r,"child_changed",t,i,n),yr(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let us,ds;class ps{constructor(){this.views=new Map}}function fs(e,t,n,r){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return i(null!=o,"SyncTree gave us an op for an invalid query."),ls(o,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(ls(s,t,n,r));return i}}function ms(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Hr(n,r?i:null),s=!1;e?s=!0:i instanceof Wi?(e=Vr(n,i),s=!1):(e=Wi.EMPTY_NODE,s=!1);const o=wr(new _r(e,s,!1),new _r(i,r,!1));return new ss(t,o)}return o}function gs(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function _s(e,t){let n=null;for(const i of e.views.values())n=n||os(i,t);return n}function vs(e,t){if(t._queryParams.loadsAllData())return Is(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ys(e,t){return null!=vs(e,t)}function ws(e){return null!=Is(e)}function Is(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let bs=1;class Ts{constructor(e){this.listenProvider_=e,this.syncPointTree_=new kr(null),this.pendingWriteTree_={visibleWrites:Sr.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Es(e,t,n,r,s){return function(e,t,n,r,s){i(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:s}),s&&(e.visibleWrites=Rr(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,s),s?As(e,new mr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Cs(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));i(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&qr(t,r.path)?s=!1:hi(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?(function(e){e.visibleWrites=Br(e.allWrites,jr,Zn()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(r.snap?e.visibleWrites=Pr(e.visibleWrites,r.path):In(r.children,(t=>{e.visibleWrites=Pr(e.visibleWrites,oi(r.path,t))})),!0))}(e.pendingWriteTree_,t)){let t=new kr(null);return null!=r.snap?t=t.set(Zn(),!0):In(r.children,(e=>{t=t.set(new Xn(e),!0)})),As(e,new pr(r.path,t,n))}return[]}function ks(e,t,n){return As(e,new mr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Ss(e,t,n,r,s=!1){const o=t._path,a=e.syncPointTree_.get(o);let c=[];if(a&&("default"===t._queryIdentifier||ys(a,t))){const l=function(e,t,n,r){const s=t._queryIdentifier,o=[];let a=[];const c=ws(e);if("default"===s)for(const[t,i]of e.views.entries())a=a.concat(cs(i,n,r)),as(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||o.push(i.query));else{const t=e.views.get(s);t&&(a=a.concat(cs(t,n,r)),as(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!ws(e)&&o.push(new(i(us,"Reference.ts has not been loaded"),us)(t._repo,t._path)),{removed:o,events:a}}(a,t,n,r);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const h=l.removed;if(c=l.events,!s){const n=-1!==h.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(o,((e,t)=>ws(t)));if(n&&!i){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&ws(t))return[Is(t)];{let e=[];return t&&(e=gs(t)),In(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=Ls(e,i);e.listenProvider_.startListening(js(r),Ms(e,r),s.hashFn,s.onComplete)}}}if(!i&&h.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(js(t),n)}else h.forEach((t=>{const n=e.queryToTagMap.get(xs(t));e.listenProvider_.stopListening(js(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=xs(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,h)}return c}function Rs(e,t,n,i){const r=Us(e,i);if(null!=r){const i=Fs(r),s=i.path,o=i.queryId,a=ci(s,t);return qs(e,s,new mr(dr(o),a,n))}return[]}function Ns(e,t,n,r=!1){const s=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(s,((e,t)=>{const n=ci(e,s);o=o||_s(t,n),a=a||ws(t)}));let c,l=e.syncPointTree_.get(s);l?(a=a||ws(l),o=o||_s(l,Zn())):(l=new ps,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?c=!0:(c=!1,o=Wi.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild(((e,t)=>{const n=_s(t,Zn());n&&(o=o.updateImmediateChild(e,n))})));const h=ys(l,t);if(!h&&!t._queryParams.loadsAllData()){const n=xs(t);i(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=bs++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=function(e,t,n,i,r,s){const o=ms(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Li,((e,t)=>{i.push(Yi(e,t))})),n.isFullyInitialized()&&i.push(Gi(n.getNode())),hs(e,i,n.getNode(),t)}(o,n)}(l,t,n,Fr(e.pendingWriteTree_,s),o,c);if(!h&&!a&&!r){const n=vs(l,t);u=u.concat(function(e,t,n){const r=t._path,s=Ms(e,t),o=Ls(e,n),a=e.listenProvider_.startListening(js(t),s,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(r);if(s)i(!ws(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!ai(e)&&t&&ws(t))return[Is(t).query];{let e=[];return t&&(e=e.concat(gs(t).map((e=>e.query)))),In(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(js(i),Ms(e,i))}}return a}(e,t,n))}return u}function Ps(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=_s(n,ci(e,t));if(i)return i}));return Wr(i,t,r,n,!0)}function As(e,t){return Os(t,e.syncPointTree_,null,Fr(e.pendingWriteTree_,Zn()))}function Os(e,t,n,i){if(ai(e.path))return Ds(e,t,n,i);{const r=t.get(Zn());null==n&&null!=r&&(n=_s(r,Zn()));let s=[];const o=ei(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Gr(i,o);s=s.concat(Os(a,c,e,t))}return r&&(s=s.concat(fs(r,e,i,n))),s}}function Ds(e,t,n,i){const r=t.get(Zn());null==n&&null!=r&&(n=_s(r,Zn()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=Gr(i,t),c=e.operationForChild(t);c&&(s=s.concat(Ds(c,r,o,a)))})),r&&(s=s.concat(fs(r,e,i,n))),s}function Ls(e,t){const n=t.query,i=Ms(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Wi.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=Us(e,n);if(i){const n=Fs(i),r=n.path,s=n.queryId,o=ci(r,t);return qs(e,r,new fr(dr(s),o))}return[]}(e,n._path,i):function(e,t){return As(e,new fr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Ss(e,n,null,i)}}}}function Ms(e,t){const n=xs(t);return e.queryToTagMap.get(n)}function xs(e){return e._path.toString()+"$"+e._queryIdentifier}function Us(e,t){return e.tagToQueryMap.get(t)}function Fs(e){const t=e.indexOf("$");return i(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Xn(e.substr(0,t))}}function qs(e,t,n){const r=e.syncPointTree_.get(t);return i(r,"Missing sync point for query tag that we're tracking"),fs(r,n,Fr(e.pendingWriteTree_,t),null)}function js(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(i(ds,"Reference.ts has not been loaded"),ds)(e._repo,e._path):e}class Bs{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Bs(t)}node(){return this.node_}}class Ws{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=oi(this.path_,e);return new Ws(this.syncTree_,t)}node(){return Ps(this.syncTree_,this.path_)}}const Hs=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Vs=function(e,t,n){return e&&"object"==typeof e?(i(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?$s(e[".sv"],t,n):"object"==typeof e[".sv"]?zs(e[".sv"],t):void i(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},$s=function(e,t,n){if("timestamp"===e)return n.timestamp;i(!1,"Unexpected server value: "+e)},zs=function(e,t,n){e.hasOwnProperty("increment")||i(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&i(!1,"Unexpected increment value: "+r);const s=t.node();if(i(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return"number"!=typeof o?r:o+r},Ks=function(e,t,n,i){return Ys(t,new Ws(n,e),i)},Gs=function(e,t,n){return Ys(e,new Bs(t),n)};function Ys(e,t,n){const i=e.getPriority().val(),r=Vs(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=Vs(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new Di(s,$i(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new Di(r))),i.forEachChild(Li,((e,i)=>{const r=Ys(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class Js{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Qs(e,t){let n=t instanceof Xn?t:new Xn(t),i=e,r=ei(n);for(;null!==r;){const e=L(i.node.children,r)||{children:{},childCount:0};i=new Js(r,i,e),n=ni(n),r=ei(n)}return i}function Xs(e){return e.node.value}function Zs(e,t){e.node.value=t,ro(e)}function eo(e){return e.node.childCount>0}function to(e,t){In(e.node.children,((n,i)=>{t(new Js(n,e,i))}))}function no(e,t,n,i){n&&!i&&t(e),to(e,(e=>{no(e,t,!0,i)})),n&&i&&t(e)}function io(e){return new Xn(null===e.parent?e.name:io(e.parent)+"/"+e.name)}function ro(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Xs(e)&&!eo(e)}(n),r=D(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,ro(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,ro(e))}(e.parent,e.name,e)}const so=/[\[\].#$\/\u0000-\u001F\u007F]/,oo=/[\[\].#$\u0000-\u001F\u007F]/,ao=10485760,co=function(e){return"string"==typeof e&&0!==e.length&&!so.test(e)},lo=function(e){return"string"==typeof e&&0!==e.length&&!oo.test(e)},ho=function(e,t,n){const i=n instanceof Xn?new ui(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+pi(i));if("function"==typeof t)throw new Error(e+"contains a function "+pi(i)+" with contents = "+t.toString());if(pn(t))throw new Error(e+"contains "+t.toString()+" "+pi(i));if("string"==typeof t&&t.length>ao/3&&z(t)>ao)throw new Error(e+"contains a string greater than "+ao+" utf8 bytes "+pi(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(In(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!co(t)))throw new Error(e+" contains an invalid key ("+t+") "+pi(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,a;a=t,(o=i).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(a),o.byteLength_+=z(a),di(o),ho(e,s,i),function(e){const t=e.parts_.pop();e.byteLength_-=z(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+pi(i)+" in addition to actual children.")}},uo=function(e,t,n,i){if(!(i&&void 0===n||lo(n)))throw new Error($(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},po=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),uo(e,t,n,i)};class fo{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function mo(e,t,n){(function(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||li(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)})(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];r&&(t(r.path)?(go(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,(e=>hi(e,t)||hi(t,e)))}function go(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();on&&cn("event: "+n.toString()),Cn(i)}}}const _o=25;class vo{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fo,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=or(),this.transactionQueueTree_=new Js,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function yo(e,t,n){if(e.stats_=jn(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new rr(e.repoInfo_,((t,n,i,r)=>{bo(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>To(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{A(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new gi(e.repoInfo_,t,((t,n,i,r)=>{bo(e,t,n,i,r)}),(t=>{To(e,t)}),(t=>{!function(e,t){In(t,((t,n)=>{Eo(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t){const n=t.toString();return qn[n]||(qn[n]=new hr(e.stats_,e.server_)),qn[n]}(e.repoInfo_),e.infoData_=new sr,e.infoSyncTree_=new Ts({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=ks(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),Eo(e,"connected",!1),e.serverSyncTree_=new Ts({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);mo(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function wo(e){const t=e.infoData_.getNode(new Xn(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Io(e){return Hs({timestamp:wo(e)})}function bo(e,t,n,i,r){e.dataUpdateCount++;const s=new Xn(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){const t=x(n,(e=>$i(e)));o=function(e,t,n,i){const r=Us(e,i);if(r){const i=Fs(r),s=i.path,o=i.queryId,a=ci(s,t),c=kr.fromObject(n);return qs(e,s,new gr(dr(o),a,c))}return[]}(e.serverSyncTree_,s,t,r)}else{const t=$i(n);o=Rs(e.serverSyncTree_,s,t,r)}else if(i){const t=x(n,(e=>$i(e)));o=function(e,t,n){const i=kr.fromObject(n);return As(e,new gr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,s,t)}else{const t=$i(n);o=ks(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=No(e,s)),mo(e.eventQueue_,a,o)}function To(e,t){Eo(e,"connected",t),!1===t&&function(e){ko(e,"onDisconnectEvents");const t=Io(e),n=or();cr(e.onDisconnect_,Zn(),((i,r)=>{const s=Ks(i,r,e.serverSyncTree_,t);ar(n,i,s)}));let i=[];cr(n,Zn(),((t,n)=>{i=i.concat(ks(e.serverSyncTree_,t,n));const r=function(e,t){const n=io(Po(e,t)),i=Qs(e.transactionQueueTree_,t);return function(e,t){let n=void 0?e:e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,(t=>{Lo(e,t)})),Lo(e,i),no(i,(t=>{Lo(e,t)})),n}(e,t);No(e,r)})),e.onDisconnect_=or(),mo(e.eventQueue_,Zn(),i)}(e)}function Eo(e,t,n){const i=new Xn("/.info/"+t),r=$i(n);e.infoData_.updateSnapshot(i,r);const s=ks(e.infoSyncTree_,i,r);mo(e.eventQueue_,i,s)}function Co(e){return e.nextWriteId_++}function ko(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),cn(n,...t)}function So(e,t,n){return Ps(e.serverSyncTree_,t,n)||Wi.EMPTY_NODE}function Ro(e,t=e.transactionQueueTree_){if(t||Do(e,t),Xs(t)){const n=Ao(e,t);i(n.length>0,"Sending zero length transaction queue"),n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),s=So(e,t,r);let o=s;const a=s.hash();for(let e=0;e<n.length;e++){const r=n[e];i(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const s=ci(t,r.path);o=o.updateChild(s,r.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(i=>{ko(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(Cs(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();Do(e,Qs(e.transactionQueueTree_,t)),Ro(e,e.transactionQueueTree_),mo(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)Cn(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{dn("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}No(e,t)}}),a)}(e,io(t),n)}else eo(t)&&to(t,(t=>{Ro(e,t)}))}function No(e,t){const n=Po(e,t),r=io(n);return function(e,t,n){if(0===t.length)return;const r=[];let s=[];const o=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const l=t[c],h=ci(n,l.path);let u,d=!1;if(i(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,s=s.concat(Cs(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=_o)d=!0,u="maxretry",s=s.concat(Cs(e.serverSyncTree_,l.currentWriteId,!0));else{const n=So(e,l.path,o);l.currentInputSnapshot=n;const i=t[c].update(n.val());if(void 0!==i){ho("transaction failed: Data returned ",i,l.path);let t=$i(i);"object"==typeof i&&null!=i&&D(i,".priority")||(t=t.updatePriority(n.getPriority()));const r=l.currentWriteId,a=Io(e),c=Gs(t,n,a);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=Co(e),o.splice(o.indexOf(r),1),s=s.concat(Es(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),s=s.concat(Cs(e.serverSyncTree_,r,!0))}else d=!0,u="nodata",s=s.concat(Cs(e.serverSyncTree_,l.currentWriteId,!0))}mo(e.eventQueue_,n,s),s=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?r.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):r.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;Do(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)Cn(r[e]);Ro(e,e.transactionQueueTree_)}(e,Ao(e,n),r),r}function Po(e,t){let n,i=e.transactionQueueTree_;for(n=ei(t);null!==n&&void 0===Xs(i);)i=Qs(i,n),n=ei(t=ni(t));return i}function Ao(e,t){const n=[];return Oo(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function Oo(e,t,n){const i=Xs(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);to(t,(t=>{Oo(e,t,n)}))}function Do(e,t){const n=Xs(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Zs(t,n.length>0?n:void 0)}to(t,(t=>{Do(e,t)}))}function Lo(e,t){const n=Xs(t);if(n){const r=[];let s=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(i(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(i(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat(Cs(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Zs(t,void 0):n.length=o+1,mo(e.eventQueue_,io(t),s);for(let e=0;e<r.length;e++)Cn(r[e])}}const Mo=function(e,t){const n=xo(e),i=n.namespace;"firebase.com"===n.domain&&un(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||un("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&dn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Mn(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new Xn(n.pathString)}},xo=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):dn(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class Uo{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+A(this.snapshot.exportVal())}}class Fo{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class qo{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return i(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class jo{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return ai(this._path)?null:ii(this._path)}get ref(){return new Bo(this._repo,this._path)}get _queryIdentifier(){const e=ir(this._queryParams),t=yn(e);return"{}"===t?"default":t}get _queryObject(){return ir(this._queryParams)}isEqual(e){if(!((e=X(e))instanceof jo))return!1;const t=this._repo===e._repo,n=li(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Bo extends jo{constructor(e,t){super(e,t,new tr,!1)}get parent(){const e=si(this._path);return null===e?null:new Bo(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Wo{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Xn(e),n=Vo(this.ref,e);return new Wo(this._node.getChild(t),n,Li)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((t,n)=>e(new Wo(n,Vo(this.ref,t),Li))))}hasChild(e){const t=new Xn(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ho(e,t){return(e=X(e))._checkNotDeleted("ref"),void 0!==t?Vo(e._root,t):e._root}function Vo(e,t){return null===ei((e=X(e))._path)?po("child","path",t,!1):uo("child","path",t,!1),new Bo(e._repo,oi(e._path,t))}function $o(e){e=X(e);const t=new qo((()=>{})),n=new zo(t);return function(e,t,n){const i=function(e,t){const n=t._path;let i=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const r=ci(e,n);i=i||_s(t,r)}));let r=e.syncPointTree_.get(n);r?i=i||_s(r,Zn()):(r=new ps,e.syncPointTree_=e.syncPointTree_.set(n,r));const s=null!=i,o=s?new _r(i,!0,!1):null;return Tr(ms(r,t,Fr(e.pendingWriteTree_,t._path),s?o.getNode():Wi.EMPTY_NODE,s).viewCache_)}(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then((i=>{const r=$i(i).withIndex(t._queryParams.getIndex());let s;if(Ns(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=ks(e.serverSyncTree_,t._path,r);else{const n=Ms(e.serverSyncTree_,t);s=Rs(e.serverSyncTree_,t._path,r,n)}return mo(e.eventQueue_,t._path,s),Ss(e.serverSyncTree_,t,n,null,!0),r}),(n=>(ko(e,"get for query "+A(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new Wo(t,new Bo(e._repo,e._path),e._queryParams.getIndex())))}class zo{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Uo("value",this,new Wo(e.snapshotNode,new Bo(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Fo(this,e,t):null}matches(e){return e instanceof zo&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(e){i(!us,"__referenceConstructor has already been defined"),us=e}(Bo),function(e){i(!ds,"__referenceConstructor has already been defined"),ds=e}(Bo);const Ko={};function Go(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||un("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),cn("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=Mo(s,r),l=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${l.namespace}`,c=Mo(s,r),l=c.repoInfo):o=!c.repoInfo.secure;const h=r&&o?new Nn(Nn.OWNER):new Rn(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!co(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),lo(e)}(n))throw new Error($(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),ai(c.path)||un("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let r=Ko[t.name];r||(r={},Ko[t.name]=r);let s=r[e.toURLString()];return s&&un("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new vo(e,false,n,i),r[e.toURLString()]=s,s}(l,e,h,new Sn(e.name,n));return new Yo(u,e)}class Yo{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(yo(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Bo(this._repo,Zn())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Ko[t];n&&n[e.key]===e||un(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&un("Cannot call "+e+" on a deleted database.")}}gi.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},gi.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Yt=ft,lt(new Z("database",((e,{instanceIdentifier:t})=>Go(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),_t(Kt,Gt,void 0),_t(Kt,Gt,"esm2017");const Jo="@firebase/installations",Qo="0.6.8",Xo=1e4,Zo=`w:${Qo}`,ea="FIS_v2",ta="https://firebaseinstallations.googleapis.com/v1",na=36e5,ia=new R("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ra(e){return e instanceof S&&e.code.includes("request-failed")}function sa({projectId:e}){return`${ta}/projects/${e}/installations`}function oa(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function aa(e,t){const n=(await t.json()).error;return ia.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ca({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function la(e){const t=await e();return t.status>=500&&t.status<600?e():t}function ha(e){return new Promise((t=>{setTimeout(t,e)}))}const ua=/^[cdef][\w-]{21}$/,da="";function pa(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return ua.test(t)?t:da}catch(e){return da}}function fa(e){return`${e.appName}!${e.appId}`}const ma=new Map;function ga(e,t){const n=fa(e);_a(n,t),function(e,t){const n=(!va&&"BroadcastChannel"in self&&(va=new BroadcastChannel("[Firebase] FID Change"),va.onmessage=e=>{_a(e.data.key,e.data.fid)}),va);n&&n.postMessage({key:e,fid:t}),0===ma.size&&va&&(va.close(),va=null)}(n,t)}function _a(e,t){const n=ma.get(e);if(n)for(const e of n)e(t)}let va=null;const ya="firebase-installations-database",wa=1,Ia="firebase-installations-store";let ba=null;function Ta(){return ba||(ba=be(ya,wa,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ia)}})),ba}async function Ea(e,t){const n=fa(e),i=(await Ta()).transaction(Ia,"readwrite"),r=i.objectStore(Ia),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||ga(e,t.fid),t}async function Ca(e){const t=fa(e),n=(await Ta()).transaction(Ia,"readwrite");await n.objectStore(Ia).delete(t),await n.done}async function ka(e,t){const n=fa(e),i=(await Ta()).transaction(Ia,"readwrite"),r=i.objectStore(Ia),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||ga(e,o.fid),o}async function Sa(e){let t;const n=await ka(e.appConfig,(n=>{const i=function(e){return Pa(e||{fid:pa(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(ia.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=sa(e),r=ca(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={fid:n,authVersion:ea,appId:e.appId,sdkVersion:Zo},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await la((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:oa(e.authToken)}}throw await aa("Create Installation",c)}(e,t);return Ea(e.appConfig,n)}catch(n){throw ra(n)&&409===n.customData.serverCode?await Ca(e.appConfig):await Ea(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Ra(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry}));return n.fid===da?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Ra(e){let t=await Na(e.appConfig);for(;1===t.registrationStatus;)await ha(100),t=await Na(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Sa(e);return n||t}return t}function Na(e){return ka(e,(e=>{if(!e)throw ia.create("installation-not-found");return Pa(e)}))}function Pa(e){return 1===(t=e).registrationStatus&&t.registrationTime+Xo<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Aa({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${sa(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){const n=ca(e);return n.append("Authorization",function(e){return`${ea} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={installation:{sdkVersion:Zo,appId:e.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await la((()=>fetch(i,a)));if(c.ok)return oa(await c.json());throw await aa("Generate Auth Token",c)}async function Oa(e,t=!1){let n;const i=await ka(e.appConfig,(i=>{if(!La(i))throw ia.create("not-registered");const r=i.authToken;if(!t&&(2===(s=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+na}(s)))return i;var s;if(1===r.requestStatus)return n=async function(e,t){let n=await Da(e.appConfig);for(;1===n.authToken.requestStatus;)await ha(100),n=await Da(e.appConfig);const i=n.authToken;return 0===i.requestStatus?Oa(e,t):i}(e,t),i;{if(!navigator.onLine)throw ia.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await Aa(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Ea(e.appConfig,i),n}catch(n){if(!ra(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Ea(e.appConfig,n)}else await Ca(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Da(e){return ka(e,(e=>{if(!La(e))throw ia.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+Xo<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function La(e){return void 0!==e&&2===e.registrationStatus}function Ma(e){return ia.create("missing-app-config-values",{valueName:e})}const xa="installations";lt(new Z(xa,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Ma("App Configuration");if(!e.name)throw Ma("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Ma(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:ht(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),lt(new Z("installations-internal",(e=>{const t=ht(e.getProvider("app").getImmediate(),xa).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await Sa(t);return i?i.catch(console.error):Oa(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await Sa(e);t&&await t}(n),(await Oa(n,t)).token}(t,e)}}),"PRIVATE")),_t(Jo,Qo),_t(Jo,Qo,"esm2017");const Ua="@firebase/performance",Fa="0.6.8",qa=Fa,ja="FB-PERF-TRACE-MEASURE",Ba="_wt_",Wa="_fcp",Ha="_fid",Va="@firebase/performance/config",$a="@firebase/performance/configexpire",za="Performance",Ka=new R("performance",za,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),Ga=new le(za);let Ya,Ja,Qa,Xa;Ga.logLevel=re.INFO;class Za{constructor(e){if(this.window=e,!e)throw Ka.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&k()?!!E()||(Ga.info("IndexedDB is not supported by current browser"),!1):(Ga.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver((e=>{for(const n of e.getEntries())t(n)})).observe({entryTypes:[e]})}static getInstance(){return void 0===Ya&&(Ya=new Za(Ja)),Ya}}function ec(){return Qa}function tc(e,t){const n=e.length-t.length;if(n<0||n>1)throw Ka.create("invalid String merger input");const i=[];for(let n=0;n<e.length;n++)i.push(e.charAt(n)),t.length>n&&i.push(t.charAt(n));return i.join("")}class nc{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=tc("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=tc("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Xa&&(Xa=new nc),Xa}}var ic;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(ic||(ic={}));const rc=["firebase_","google_","ga_"],sc=new RegExp("^[a-zA-Z]\\w*$");function oc(){const e=Za.getInstance().navigator;return(null==e?void 0:e.serviceWorker)?e.serviceWorker.controller?2:3:1}function ac(){switch(Za.getInstance().document.visibilityState){case"visible":return ic.VISIBLE;case"hidden":return ic.HIDDEN;default:return ic.UNKNOWN}}function cc(){const e=Za.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function lc(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.appId;if(!n)throw Ka.create("no app id");return n}const hc="0.0.1",uc={loggingEnabled:!0},dc="FIREBASE_INSTALLATIONS_AUTH";const pc="Could not fetch config, will use default configs";function fc(e){if(!e)return e;const t=nc.getInstance(),n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=uc.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):uc.logSource&&(t.logSource=uc.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:uc.logEndPointUrl&&(t.logEndPointUrl=uc.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:uc.transportKey&&(t.transportKey=uc.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==uc.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=uc.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==uc.tracesSamplingRate&&(t.tracesSamplingRate=uc.tracesSamplingRate),t.logTraceAfterSampling=mc(t.tracesSamplingRate),t.logNetworkAfterSampling=mc(t.networkRequestsSamplingRate),e}function mc(e){return Math.random()<=e}let gc,_c=1;function vc(e){return _c=2,gc=gc||function(e){return function(){const e=Za.getInstance().document;return new Promise((t=>{if(e&&"complete"!==e.readyState){const n=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()}))}().then((()=>function(e){const t=e.getId();return t.then((e=>{Qa=e})),t}(e.installations))).then((t=>function(e,t){const n=function(){const e=Za.getInstance().localStorage;if(!e)return;const t=e.getItem($a);if(!(t&&(n=t,Number(n)>Date.now())))return;var n;const i=e.getItem(Va);if(i)try{return JSON.parse(i)}catch(e){return}}();return n?(fc(n),Promise.resolve()):function(e,t){return function(e){const t=e.getToken();return t.then((e=>{})),t}(e.installations).then((n=>{const i=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!n)throw Ka.create("no project id");return n}(e.app),r=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!n)throw Ka.create("no api key");return n}(e.app),s=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${i}/namespaces/fireperf:fetch?key=${r}`,{method:"POST",headers:{Authorization:`${dc} ${n}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:n,app_id:lc(e.app),app_version:qa,sdk_version:hc})});return fetch(s).then((e=>{if(e.ok)return e.json();throw Ka.create("RC response not ok")}))})).catch((()=>{Ga.info(pc)}))}(e,t).then(fc).then((e=>function(e){const t=Za.getInstance().localStorage;e&&t&&(t.setItem(Va,JSON.stringify(e)),t.setItem($a,String(Date.now()+60*nc.getInstance().configTimeToLive*60*1e3)))}(e)),(()=>{}))}(e,t))).then((()=>yc()),(()=>yc()))}(e),gc}function yc(){_c=3}const wc=1e4;let Ic,bc=3,Tc=[],Ec=!1;function Cc(e){setTimeout((()=>{if(0!==bc)return Tc.length?void function(){const e=Tc.splice(0,1e3),t=e.map((e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})));(function(e,t){return function(e){const t=nc.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then((e=>(e.ok||Ga.info("Call to Firebase backend failed."),e.json()))).then((e=>{const n=Number(e.nextRequestWaitMillis);let i=wc;isNaN(n)||(i=Math.max(n,i));const r=e.logResponseDetails;Array.isArray(r)&&r.length>0&&"RETRY_REQUEST_LATER"===r[0].responseAction&&(Tc=[...t,...Tc],Ga.info("Retry transport request later.")),bc=3,Cc(i)}))})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:nc.getInstance().logSource,log_event:t},e).catch((()=>{Tc=[...e,...Tc],bc--,Ga.info(`Tries left: ${bc}.`),Cc(wc)}))}():Cc(wc)}),e)}function kc(e,t){Ic||(Ic=function(e){return(...t)=>{!function(e){if(!e.eventTime||!e.message)throw Ka.create("invalid cc log");Tc=[...Tc,e]}({message:e(...t),eventTime:Date.now()})}}(Nc)),Ic(e,t)}function Sc(e){const t=nc.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&Za.getInstance().requiredApisAvailable()&&(e.isAuto&&ac()!==ic.VISIBLE||(3===_c?Rc(e):vc(e.performanceController).then((()=>Rc(e)),(()=>Rc(e)))))}function Rc(e){if(!ec())return;const t=nc.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&setTimeout((()=>kc(e,1)),0)}function Nc(e,t){return 0===t?function(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:Pc(e.performanceController.app),network_request_metric:t};return JSON.stringify(n)}(e):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);const i={application_info:Pc(e.performanceController.app),trace_metric:t};return JSON.stringify(i)}(e)}function Pc(e){return{google_app_id:lc(e),app_instance_id:ec(),web_app_info:{sdk_version:qa,page_url:Za.getInstance().getUrl(),service_worker_status:oc(),visibility_state:ac(),effective_connection_type:cc()},application_process_state:0}}const Ac=["_fp",Wa,Ha];class Oc{constructor(e,t,n=!1,i){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=Za.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=i||`${ja}-${this.randomId}-${this.name}`,i&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Ka.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Ka.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Sc(this)}record(e,t,n){if(e<=0)throw Ka.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Ka.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const e of Object.keys(n.metrics))isNaN(Number(n.metrics[e]))||(this.counters[e]=Math.floor(Number(n.metrics[e])));Sc(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,i=this.name,0===n.length||n.length>100||!(i&&i.startsWith(Ba)&&Ac.indexOf(n)>-1)&&n.startsWith("_"))throw Ka.create("invalid custom metric name",{customMetricName:e});var n,i;this.counters[e]=function(e){const t=Math.floor(e);return t<e&&Ga.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}(null!=t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const n=!(0===(i=e).length||i.length>40||rc.some((e=>i.startsWith(e)))||!i.match(sc));var i;const r=function(e){return 0!==e.length&&e.length<=100}(t);if(n&&r)this.customAttributes[e]=t;else{if(!n)throw Ka.create("invalid attribute name",{attributeName:e});if(!r)throw Ka.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,i){const r=Za.getInstance().getUrl();if(!r)return;const s=new Oc(e,Ba+r,!0),o=Math.floor(1e3*Za.getInstance().getTimeOrigin());if(s.setStartTime(o),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n){const e=n.find((e=>"first-paint"===e.name));e&&e.startTime&&s.putMetric("_fp",Math.floor(1e3*e.startTime));const t=n.find((e=>"first-contentful-paint"===e.name));t&&t.startTime&&s.putMetric(Wa,Math.floor(1e3*t.startTime)),i&&s.putMetric(Ha,Math.floor(1e3*i))}Sc(s)}static createUserTimingTrace(e,t){Sc(new Oc(e,t,!1,t))}}function Dc(e,t){const n=t;if(!n||void 0===n.responseStart)return;const i=Za.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+i)),s=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,o=Math.floor(1e3*(n.responseEnd-n.startTime));!function(e){const t=nc.getInstance();if(!t.instrumentationEnabled)return;const n=e.url,i=t.logEndPointUrl.split("?")[0],r=t.flTransportEndpointUrl.split("?")[0];n!==i&&n!==r&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout((()=>kc(e,0)),0)}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o})}function Lc(e){ec()&&(setTimeout((()=>function(e){const t=Za.getInstance(),n=t.getEntriesByType("navigation"),i=t.getEntriesByType("paint");if(t.onFirstInputDelay){let r=setTimeout((()=>{Oc.createOobTrace(e,n,i),r=void 0}),5e3);t.onFirstInputDelay((t=>{r&&(clearTimeout(r),Oc.createOobTrace(e,n,i,t))}))}else Oc.createOobTrace(e,n,i)}(e)),0),setTimeout((()=>function(e){const t=Za.getInstance(),n=t.getEntriesByType("resource");for(const t of n)Dc(e,t);t.setupObserver("resource",(t=>Dc(e,t)))}(e)),0),setTimeout((()=>function(e){const t=Za.getInstance(),n=t.getEntriesByType("measure");for(const t of n)Mc(e,t);t.setupObserver("measure",(t=>Mc(e,t)))}(e)),0))}function Mc(e,t){const n=t.name;n.substring(0,ja.length)!==ja&&Oc.createUserTimingTrace(e,n)}class xc{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Za.getInstance().requiredApisAvailable()?C().then((e=>{e&&(Ec||(Cc(5500),Ec=!0),vc(this).then((()=>Lc(this)),(()=>Lc(this))),this.initialized=!0)})).catch((e=>{Ga.info(`Environment doesn't support IndexedDB: ${e}`)})):Ga.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){nc.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return nc.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){nc.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return nc.getInstance().dataCollectionEnabled}}lt(new Z("performance",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw Ka.create("FB not default");if("undefined"==typeof window)throw Ka.create("no window");!function(e){Ja=e}(window);const r=new xc(n,i);return r._init(t),r}),"PUBLIC")),_t(Ua,Fa),_t(Ua,Fa,"esm2017");const Uc={};function Fc(e){return Object.isFrozen(e)&&Object.isFrozen(e.raw)}function qc(e){return-1===e.toString().indexOf("`")}qc((e=>e``))||qc((e=>e`\0`))||qc((e=>e`\n`))||qc((e=>e`\u0000`)),Fc``&&Fc`\0`&&Fc`\n`&&Fc`\u0000`;let jc,Bc="google#safe";function Wc(){var e;return""!==Bc&&null!==(e=function(){if("undefined"!=typeof window)return window.trustedTypes}())&&void 0!==e?e:null}"undefined"!=typeof window&&window.TrustedHTML;class Hc{constructor(e,t){this.privateDoNotAccessOrElseWrappedResourceUrl=e}toString(){return this.privateDoNotAccessOrElseWrappedResourceUrl.toString()}}function Vc(e){var t;const n=e,i=null===(t=function(){var e,t;if(void 0===jc)try{jc=null!==(t=null===(e=Wc())||void 0===e?void 0:e.createPolicy(Bc,{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e}))&&void 0!==t?t:null}catch(e){jc=null}return jc}())||void 0===t?void 0:t.createScriptURL(n);return null!=i?i:new Hc(n,Uc)}var $c,zc,Kc,Gc;function Yc(e){return{valueOf:e}.valueOf()}"undefined"!=typeof window&&window.TrustedScriptURL,"undefined"!=typeof window&&window.TrustedScript,(Kc=$c||($c={}))[Kc.STYLE_TAG=0]="STYLE_TAG",Kc[Kc.STYLE_ATTRIBUTE=1]="STYLE_ATTRIBUTE",Kc[Kc.HTML_ATTRIBUTE=2]="HTML_ATTRIBUTE";class Jc{constructor(e,t,n,i,r){this.allowedElements=e,this.elementPolicies=t,this.allowedGlobalAttributes=n,this.globalAttributePolicies=i,this.globallyAllowedAttributePrefixes=r}isAllowedElement(e){return"FORM"!==e&&(this.allowedElements.has(e)||this.elementPolicies.has(e))}getAttributePolicy(e,t){const n=this.elementPolicies.get(t);if(null==n?void 0:n.has(e))return n.get(e);if(this.allowedGlobalAttributes.has(e))return{policyAction:zc.KEEP};return this.globalAttributePolicies.get(e)||(this.globallyAllowedAttributePrefixes&&[...this.globallyAllowedAttributePrefixes].some((t=>0===e.indexOf(t)))?{policyAction:zc.KEEP}:{policyAction:zc.DROP})}}(Gc=zc||(zc={}))[Gc.DROP=0]="DROP",Gc[Gc.KEEP=1]="KEEP",Gc[Gc.KEEP_AND_SANITIZE_URL=2]="KEEP_AND_SANITIZE_URL",Gc[Gc.KEEP_AND_NORMALIZE=3]="KEEP_AND_NORMALIZE",Gc[Gc.KEEP_AND_SANITIZE_STYLE=4]="KEEP_AND_SANITIZE_STYLE",Gc[Gc.KEEP_AND_USE_RESOURCE_URL_POLICY=5]="KEEP_AND_USE_RESOURCE_URL_POLICY",Gc[Gc.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET=6]="KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET",new Set(["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"]);const Qc=["ARTICLE","SECTION","NAV","ASIDE","H1","H2","H3","H4","H5","H6","HEADER","FOOTER","ADDRESS","P","HR","PRE","BLOCKQUOTE","OL","UL","LH","LI","DL","DT","DD","FIGURE","FIGCAPTION","MAIN","DIV","EM","STRONG","SMALL","S","CITE","Q","DFN","ABBR","RUBY","RB","RT","RTC","RP","DATA","TIME","CODE","VAR","SAMP","KBD","SUB","SUP","I","B","U","MARK","BDI","BDO","SPAN","BR","WBR","INS","DEL","PICTURE","PARAM","TRACK","MAP","TABLE","CAPTION","COLGROUP","COL","TBODY","THEAD","TFOOT","TR","TD","TH","SELECT","DATALIST","OPTGROUP","OPTION","OUTPUT","PROGRESS","METER","FIELDSET","LEGEND","DETAILS","SUMMARY","MENU","DIALOG","SLOT","CANVAS","FONT","CENTER","ACRONYM","BASEFONT","BIG","DIR","HGROUP","STRIKE","TT"],Xc=[["A",new Map([["href",{policyAction:zc.KEEP_AND_SANITIZE_URL}]])],["AREA",new Map([["href",{policyAction:zc.KEEP_AND_SANITIZE_URL}]])],["LINK",new Map([["href",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY,conditions:new Map([["rel",new Set(["alternate","author","bookmark","canonical","cite","help","icon","license","next","prefetch","dns-prefetch","prerender","preconnect","preload","prev","search","subresource"])]])}]])],["SOURCE",new Map([["src",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["IMG",new Map([["src",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["VIDEO",new Map([["src",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY}]])],["AUDIO",new Map([["src",{policyAction:zc.KEEP_AND_USE_RESOURCE_URL_POLICY}]])]],Zc=["title","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-current","aria-disabled","aria-dropeffect","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","alt","align","autocapitalize","autocomplete","autocorrect","autofocus","autoplay","bgcolor","border","cellpadding","cellspacing","checked","color","cols","colspan","controls","datetime","disabled","download","draggable","enctype","face","formenctype","frameborder","height","hreflang","hidden","ismap","label","lang","loop","max","maxlength","media","minlength","min","multiple","muted","nonce","open","placeholder","preload","rel","required","reversed","role","rows","rowspan","selected","shape","size","sizes","slot","span","spellcheck","start","step","summary","translate","type","valign","value","width","wrap","itemscope","itemtype","itemid","itemprop","itemref"],el=[["dir",{policyAction:zc.KEEP_AND_NORMALIZE,conditions:Yc((()=>new Map([["dir",new Set(["auto","ltr","rtl"])]])))}],["async",{policyAction:zc.KEEP_AND_NORMALIZE,conditions:Yc((()=>new Map([["async",new Set(["async"])]])))}],["cite",{policyAction:zc.KEEP_AND_SANITIZE_URL}],["loading",{policyAction:zc.KEEP_AND_NORMALIZE,conditions:Yc((()=>new Map([["loading",new Set(["eager","lazy"])]])))}],["poster",{policyAction:zc.KEEP_AND_SANITIZE_URL}],["target",{policyAction:zc.KEEP_AND_NORMALIZE,conditions:Yc((()=>new Map([["target",new Set(["_self","_blank"])]])))}]];function tl(e,...t){if(0===t.length)return Vc(e[0]);e[0].toLowerCase();let n=e[0];for(let i=0;i<t.length;i++)n+=encodeURIComponent(t[i])+e[i+1];return Vc(n)}function nl(e,t,n){e.src=function(e){var t;if(null===(t=Wc())||void 0===t?void 0:t.isScriptURL(e))return e;if(e instanceof Hc)return e.privateDoNotAccessOrElseWrappedResourceUrl;throw new Error("")}(t),(null==n?void 0:n.omitNonce)||function(e){const t=function(e,t){var n;const i=t.document,r=null===(n=i.querySelector)||void 0===n?void 0:n.call(i,`${e}[nonce]`);return r&&(r.nonce||r.getAttribute("nonce"))||""}("script",e.ownerDocument&&e.ownerDocument.defaultView||window);t&&e.setAttribute("nonce",t)}(e)}new Jc(new Set(Qc),new Map(Xc),new Set(Zc),new Map(el)),new Jc(new Set(Yc((()=>Qc.concat(["STYLE"])))),new Map(Xc),new Set(Yc((()=>Zc.concat(["id","name","class"])))),new Map(Yc((()=>el.concat([["style",{policyAction:zc.KEEP_AND_SANITIZE_STYLE}]]))))),Error;const il="analytics",rl="firebase_id",sl="origin",ol=6e4,al="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",cl="https://www.googletagmanager.com/gtag/js",ll=new le("@firebase/analytics");function hl(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}function ul(e,t){const n=document.createElement("script");nl(n,tl`https://www.googletagmanager.com/gtag/js?l=${e}&id=${t}`),n.async=!0,document.head.appendChild(n)}const dl=new R("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."}),pl=30,fl=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function ml(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function gl(e,t=fl,n){const{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw dl.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw dl.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new vl;return setTimeout((async()=>{a.abort()}),void 0!==n?n:ol),_l({appId:i,apiKey:r,measurementId:s},o,a,t)}async function _l(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=fl){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(n,r);e.addEventListener((()=>{clearTimeout(s),i(dl.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return ll.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:ml(i)},s=al.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw dl.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return r.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof S&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(r.deleteThrottleMetadata(o),a)return ll.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const l=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?Q(n,r.intervalMillis,pl):Q(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return r.setThrottleMetadata(o,h),ll.debug(`Calling attemptFetch again in ${l} millis`),_l(e,h,i,r)}}class vl{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let yl,wl;async function Il(e,t,n,i,r,s,o){var a;const c=gl(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&ll.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>ll.error(e))),t.push(c);const l=async function(){if(!E())return ll.warn(dl.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await C()}catch(e){return ll.warn(dl.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,u]=await Promise.all([c,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(cl)&&n.src.includes(e))return n;return null})(s)||ul(s,h.measurementId),wl&&(r("consent","default",wl),wl=void 0),r("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[sl]="firebase",d.update=!0,null!=u&&(d[rl]=u),r("config",h.measurementId,d),yl&&(r("set",yl),yl=void 0),h.measurementId}class bl{constructor(e){this.app=e}_delete(){return delete Tl[this.app.options.appId],Promise.resolve()}}let Tl={},El=[];const Cl={};let kl,Sl,Rl="dataLayer",Nl=!1;function Pl(e,t,n){!function(){const e=[];if(b()&&e.push("This is a browser extension environment."),k()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=dl.create("invalid-analytics-context",{errorInfo:t});ll.warn(n.message)}}();const i=e.options.appId;if(!i)throw dl.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw dl.create("no-api-key");ll.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Tl[i])throw dl.create("already-exists",{id:i});if(!Nl){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Rl);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let s=function(...e){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(e,t,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await hl(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){ll.error(e)}}(e,t,n,i,r)}else if("config"===r){const[r,o]=s;await async function(e,t,n,i,r,s){const o=i[r];try{if(o)await t[o];else{const e=(await hl(n)).find((e=>e.measurementId===r));e&&await t[e.appId]}}catch(e){ll.error(e)}e("config",r,s)}(e,t,n,i,r,o)}else if("consent"===r){const[t,n]=s;e("consent",t,n)}else if("get"===r){const[t,n,i]=s;e("get",t,n,i)}else if("set"===r){const[t]=s;e("set",t)}else e(r,...s)}catch(e){ll.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[r]}}(Tl,El,Cl,Rl,"gtag");Sl=e,kl=t,Nl=!0}return Tl[i]=Il(e,El,Cl,t,kl,Rl,n),new bl(e)}const Al="@firebase/analytics",Ol="0.10.6";function Dl(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}lt(new Z(il,((e,{options:t})=>Pl(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),lt(new Z("analytics-internal",(function(e){try{const t=e.getProvider(il).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=X(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(Sl,Tl[e.app.options.appId],t,n,i).catch((e=>ll.error(e)))}(t,e,n,i)}}catch(e){throw dl.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),_t(Al,Ol),_t(Al,Ol,"esm2017"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Ll=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Ml=new R("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),xl=new le("@firebase/auth");function Ul(e,...t){xl.logLevel<=re.ERROR&&xl.error(`Auth (${ft}): ${e}`,...t)}function Fl(e,...t){throw Wl(e,...t)}function ql(e,...t){return Wl(e,...t)}function jl(e,t,n){const i=Object.assign(Object.assign({},Ll()),{[t]:n});return new R("auth","Firebase",i).create(t,{appName:e.name})}function Bl(e){return jl(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wl(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Ml.create(e,...t)}function Hl(e,t,...n){if(!e)throw Wl(t,...n)}function Vl(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Ul(t),new Error(t)}function $l(e,t){e||Vl(t)}function zl(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Kl(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Gl{constructor(e,t){this.shortDelay=e,this.longDelay=t,$l(t>e,"Short delay should be less than long delay!"),this.isMobile=I()||T()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Kl()||"https:"===Kl()||b()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Yl(e,t){$l(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Jl{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Vl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Vl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Vl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ql={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Xl=new Gl(3e4,6e4);function Zl(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function eh(e,t,n,i,r={}){return th(e,r,(async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=q(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Jl.fetch()(ih(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},r))}))}async function th(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Ql),t);try{const t=new sh(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw oh(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw oh(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw oh(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw oh(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw jl(e,a,o);Fl(e,a)}}catch(t){if(t instanceof S)throw t;Fl(e,"network-request-failed",{message:String(t)})}}async function nh(e,t,n,i,r={}){const s=await eh(e,t,n,i,r);return"mfaPendingCredential"in s&&Fl(e,"multi-factor-auth-required",{_serverResponse:s}),s}function ih(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?Yl(e.config,r):`${e.config.apiScheme}://${r}`}function rh(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class sh{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(ql(this.auth,"network-request-failed"))),Xl.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function oh(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=ql(e,t,i);return r.customData._tokenResponse=n,r}function ah(e){return void 0!==e&&void 0!==e.enterprise}class ch{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return rh(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function lh(e,t){return eh(e,"POST","/v1/accounts:lookup",t)}function hh(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function uh(e){return 1e3*Number(e)}function dh(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return Ul("JWT malformed, contained fewer than 3 sections"),null;try{const e=h(n);return e?JSON.parse(e):(Ul("Failed to decode base64 JWT payload"),null)}catch(e){return Ul("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function ph(e){const t=dh(e);return Hl(t,"internal-error"),Hl(void 0!==t.exp,"internal-error"),Hl(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function fh(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof S&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class mh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class gh{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=hh(this.lastLoginAt),this.creationTime=hh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function _h(e){var t;const n=e.auth,i=await e.getIdToken(),r=await fh(e,lh(n,{idToken:i}));Hl(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?vh(s.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new gh(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function vh(e){return e.map((e=>{var{providerId:t}=e,n=Dl(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class yh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Hl(e.idToken,"internal-error"),Hl(void 0!==e.idToken,"internal-error"),Hl(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ph(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Hl(0!==e.length,"internal-error");const t=ph(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Hl(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await th(e,{},(async()=>{const n=q({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=ih(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Jl.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new yh;return n&&(Hl("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(Hl("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(Hl("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yh,this.toJSON())}_performRefresh(){return Vl("not implemented")}}function wh(e,t){Hl("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ih{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=Dl(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new mh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new gh(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await fh(this,this.stsTokenManager.getToken(this.auth,e));return Hl(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=X(e),i=await n.getIdToken(t),r=dh(i);Hl(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:hh(uh(r.auth_time)),issuedAtTime:hh(uh(r.iat)),expirationTime:hh(uh(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=X(e);await _h(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Hl(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ih(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Hl(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await _h(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ut(this.auth.app))return Promise.reject(Bl(this.auth));const e=await this.getIdToken();return await fh(this,async function(e,t){return eh(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,_=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:y,isAnonymous:w,providerData:I,stsTokenManager:b}=t;Hl(v&&b,e,"internal-error");const T=yh.fromJSON(this.name,b);Hl("string"==typeof v,e,"internal-error"),wh(h,e.name),wh(u,e.name),Hl("boolean"==typeof y,e,"internal-error"),Hl("boolean"==typeof w,e,"internal-error"),wh(d,e.name),wh(p,e.name),wh(f,e.name),wh(m,e.name),wh(g,e.name),wh(_,e.name);const E=new Ih({uid:v,auth:e,email:u,emailVerified:y,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:T,createdAt:g,lastLoginAt:_});return I&&Array.isArray(I)&&(E.providerData=I.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const i=new yh;i.updateFromServerResponse(t);const r=new Ih({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await _h(r),r}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];Hl(void 0!==i.localId,"internal-error");const r=void 0!==i.providerUserInfo?vh(i.providerUserInfo):[],s=!(i.email&&i.passwordHash||(null==r?void 0:r.length)),o=new yh;o.updateFromIdToken(n);const a=new Ih({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new gh(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||(null==r?void 0:r.length))};return Object.assign(a,c),a}}const bh=new Map;function Th(e){$l(e instanceof Function,"Expected a class definition");let t=bh.get(e);return t?($l(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,bh.set(e,t),t)}class Eh{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Eh.type="NONE";const Ch=Eh;function kh(e,t,n){return`firebase:${e}:${t}:${n}`}class Sh{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=kh(this.userKey,i.apiKey,r),this.fullPersistenceKey=kh("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ih._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Sh(Th(Ch),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||Th(Ch);const s=kh(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const i=Ih._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new Sh(r,e,n)):new Sh(r,e,n)}}function Rh(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Oh(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Nh(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Lh(t))return"Blackberry";if(Mh(t))return"Webos";if(Ph(t))return"Safari";if((t.includes("chrome/")||Ah(t))&&!t.includes("edge/"))return"Chrome";if(Dh(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Nh(e=w()){return/firefox\//i.test(e)}function Ph(e=w()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ah(e=w()){return/crios\//i.test(e)}function Oh(e=w()){return/iemobile/i.test(e)}function Dh(e=w()){return/android/i.test(e)}function Lh(e=w()){return/blackberry/i.test(e)}function Mh(e=w()){return/webos/i.test(e)}function xh(e=w()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Uh(e=w()){return xh(e)||Dh(e)||Mh(e)||Lh(e)||/windows phone/i.test(e)||Oh(e)}function Fh(e,t=[]){let n;switch(e){case"Browser":n=Rh(w());break;case"Worker":n=`${Rh(w())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ft}/${i}`}class qh{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class jh{constructor(e){var t,n,i,r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(i=a.containsLowercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(r=a.containsUppercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class Bh{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hh(this),this.idTokenSubscription=new Hh(this),this.beforeStateQueue=new qh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ml,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Th(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Sh.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await lh(this,{idToken:e}),n=await Ih._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ut(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Hl(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _h(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ut(this.app))return Promise.reject(Bl(this));const t=e?X(e):null;return t&&Hl(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Hl(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return ut(this.app)?Promise.reject(Bl(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ut(this.app)?Promise.reject(Bl(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Th(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return eh(e,"GET","/v2/passwordPolicy",Zl(e,t))}(this),t=new jh(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new R("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return eh(e,"POST","/v2/accounts:revokeToken",Zl(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Th(e)||this._popupRedirectResolver;Hl(t,this,"argument-error"),this.redirectPersistenceManager=await Sh.create(this,[Th(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Hl(o,this,"internal-error"),o.then((()=>{s||r(this.currentUser)})),"function"==typeof t){const r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Hl(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Fh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){xl.logLevel<=re.WARN&&xl.warn(`Auth (${ft}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Wh(e){return X(e)}class Hh{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new H(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return Hl(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Vh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function $h(e){return Vh.loadJS(e)}function zh(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Kh{constructor(e){this.type="recaptcha-enterprise",this.auth=Wh(e)}async verify(e="verify",t=!1){function n(t,n,i){const r=window.grecaptcha;ah(r)?r.enterprise.ready((()=>{r.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return eh(e,"GET","/v2/recaptchaConfig",Zl(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new ch(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((r=>{if(!t&&ah(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Vh.recaptchaEnterpriseScript;0!==t.length&&(t+=r),$h(t).then((()=>{n(r,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Gh(e,t,n,i=!1){const r=new Kh(e);let s;try{s=await r.verify(n)}catch(e){s=await r.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Yh(e,t,n,i){var r;if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await Gh(e,t,n,"getOobCode"===n);return i(e,r)}return i(e,t).catch((async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await Gh(e,t,n,"getOobCode"===n);return i(e,r)}return Promise.reject(r)}))}function Jh(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Qh(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Xh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Vl("not implemented")}_getIdTokenResponse(e){return Vl("not implemented")}_linkToIdToken(e,t){return Vl("not implemented")}_getReauthenticationResolver(e){return Vl("not implemented")}}async function Zh(e,t){return eh(e,"POST","/v1/accounts:signUp",t)}async function eu(e,t){return nh(e,"POST","/v1/accounts:signInWithPassword",Zl(e,t))}class tu extends Xh{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new tu(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new tu(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Yh(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",eu);case"emailLink":return async function(e,t){return nh(e,"POST","/v1/accounts:signInWithEmailLink",Zl(e,t))}(e,{email:this._email,oobCode:this._password});default:Fl(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Yh(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Zh);case"emailLink":return async function(e,t){return nh(e,"POST","/v1/accounts:signInWithEmailLink",Zl(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Fl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nu(e,t){return nh(e,"POST","/v1/accounts:signInWithIdp",Zl(e,t))}class iu extends Xh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new iu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Fl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=Dl(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new iu(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return nu(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,nu(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,nu(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=q(t)}return e}}const ru={USER_NOT_FOUND:"user-not-found"};class su extends Xh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new su({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new su({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return nh(e,"POST","/v1/accounts:signInWithPhoneNumber",Zl(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await nh(e,"POST","/v1/accounts:signInWithPhoneNumber",Zl(e,t));if(n.temporaryProof)throw oh(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return nh(e,"POST","/v1/accounts:signInWithPhoneNumber",Zl(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ru)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new su({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class ou{constructor(e){var t,n,i,r,s,o;const a=j(B(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Hl(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=j(B(e)).link,n=t?j(B(t)).deep_link_id:null,i=j(B(e)).deep_link_id;return(i?j(B(i)).link:null)||i||n||t||e}(e);try{return new ou(t)}catch(e){return null}}}class au{constructor(){this.providerId=au.PROVIDER_ID}static credential(e,t){return tu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ou.parseLink(t);return Hl(n,"argument-error"),tu._fromEmailAndCode(e,n.code,n.tenantId)}}au.PROVIDER_ID="password",au.EMAIL_PASSWORD_SIGN_IN_METHOD="password",au.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class lu extends cu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class hu extends lu{constructor(){super("facebook.com")}static credential(e){return iu._fromParams({providerId:hu.PROVIDER_ID,signInMethod:hu.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return hu.credentialFromTaggedObject(e)}static credentialFromError(e){return hu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return hu.credential(e.oauthAccessToken)}catch(e){return null}}}hu.FACEBOOK_SIGN_IN_METHOD="facebook.com",hu.PROVIDER_ID="facebook.com";class uu extends lu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return iu._fromParams({providerId:uu.PROVIDER_ID,signInMethod:uu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return uu.credentialFromTaggedObject(e)}static credentialFromError(e){return uu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return uu.credential(t,n)}catch(e){return null}}}uu.GOOGLE_SIGN_IN_METHOD="google.com",uu.PROVIDER_ID="google.com";class du extends lu{constructor(){super("github.com")}static credential(e){return iu._fromParams({providerId:du.PROVIDER_ID,signInMethod:du.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return du.credentialFromTaggedObject(e)}static credentialFromError(e){return du.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return du.credential(e.oauthAccessToken)}catch(e){return null}}}du.GITHUB_SIGN_IN_METHOD="github.com",du.PROVIDER_ID="github.com";class pu extends lu{constructor(){super("twitter.com")}static credential(e,t){return iu._fromParams({providerId:pu.PROVIDER_ID,signInMethod:pu.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return pu.credentialFromTaggedObject(e)}static credentialFromError(e){return pu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return pu.credential(t,n)}catch(e){return null}}}pu.TWITTER_SIGN_IN_METHOD="twitter.com",pu.PROVIDER_ID="twitter.com";class fu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await Ih._fromIdTokenResponse(e,n,i),s=mu(n);return new fu({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=mu(n);return new fu({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function mu(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class gu extends S{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,gu.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new gu(e,t,n,i)}}function _u(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw gu._fromErrorAndOperation(e,n,t,i);throw n}))}new WeakMap;const vu="__sak";class yu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vu,"1"),this.storage.removeItem(vu),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class wu extends yu{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=w();return Ph(e)||xh(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Uh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);!function(){const e=w();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||r===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}wu.type="LOCAL";const Iu=wu;class bu extends yu{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}bu.type="SESSION";const Tu=bu;class Eu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Eu(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Cu(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Eu.receivers=[];class ku{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=Cu("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(l),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Su(){return window}function Ru(){return void 0!==Su().WorkerGlobalScope&&"function"==typeof Su().importScripts}const Nu="firebaseLocalStorageDb",Pu="firebaseLocalStorage",Au="fbase_key";class Ou{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Du(e,t){return e.transaction([Pu],t?"readwrite":"readonly").objectStore(Pu)}function Lu(){const e=indexedDB.open(Nu,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Pu,{keyPath:Au})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Pu)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Nu);return new Ou(e).toPromise()}(),t(await Lu()))}))}))}async function Mu(e,t,n){const i=Du(e,!0).put({[Au]:t,value:n});return new Ou(i).toPromise()}function xu(e,t){const n=Du(e,!0).delete(t);return new Ou(n).toPromise()}class Uu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Lu()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ru()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Eu._getInstance(Ru()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ku(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}var t}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lu();return await Mu(e,vu,"1"),await xu(e,vu),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Mu(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Du(e,!1).get(t),i=await new Ou(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>xu(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Du(e,!1).getAll();return new Ou(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Uu.type="LOCAL";const Fu=Uu;zh("rcb"),new Gl(3e4,6e4);class qu{constructor(e){this.providerId=qu.PROVIDER_ID,this.auth=Wh(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var i;const r=await n.verify();try{let s;if(Hl("string"==typeof r,e,"argument-error"),Hl("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Hl("enroll"===t.type,e,"internal-error");const n=await function(e,t){return eh(e,"POST","/v2/accounts/mfaEnrollment:start",Zl(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{Hl("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;Hl(n,e,"missing-multi-factor-info");const o=await function(e,t){return eh(e,"POST","/v2/accounts/mfaSignIn:start",Zl(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return eh(e,"POST","/v1/accounts:sendVerificationCode",Zl(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}(this.auth,e,X(t))}static credential(e,t){return su._fromVerification(e,t)}static credentialFromResult(e){const t=e;return qu.credentialFromTaggedObject(t)}static credentialFromError(e){return qu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?su._fromTokenResponse(t,n):null}}qu.PROVIDER_ID="phone",qu.PHONE_SIGN_IN_METHOD="phone";class ju extends Xh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Bu(e){return async function(e,t,n=!1){if(ut(e.app))return Promise.reject(Bl(e));const i="signIn",r=await _u(e,i,t),s=await fu._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}(e.auth,new ju(e),e.bypassAuthState)}function Wu(e){const{auth:t,user:n}=e;return Hl(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e;if(ut(i.app))return Promise.reject(Bl(i));const r="reauthenticate";try{const s=await fh(e,_u(i,r,t,e),n);Hl(s.idToken,i,"internal-error");const o=dh(s.idToken);Hl(o,i,"internal-error");const{sub:a}=o;return Hl(e.uid===a,i,"user-mismatch"),fu._forOperation(e,r,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Fl(i,"user-mismatch"),e}}(n,new ju(e),e.bypassAuthState)}async function Hu(e){const{auth:t,user:n}=e;return Hl(n,t,"internal-error"),async function(e,t,n=!1){const i=await fh(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return fu._forOperation(e,"link",i)}(n,new ju(e),e.bypassAuthState)}class Vu{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Bu;case"linkViaPopup":case"linkViaRedirect":return Hu;case"reauthViaPopup":case"reauthViaRedirect":return Wu;default:Fl(this.auth,"internal-error")}}resolve(e){$l(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$l(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const $u=new Gl(2e3,1e4);class zu extends Vu{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,zu.currentPopupAction&&zu.currentPopupAction.cancel(),zu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Hl(e,this.auth,"internal-error"),e}async onExecution(){$l(1===this.filter.length,"Popup operations only handle one event");const e=Cu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(ql(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ql(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(ql(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,$u.get())};e()}}zu.currentPopupAction=null;const Ku="pendingRedirect",Gu=new Map;class Yu extends Vu{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Gu.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return kh(Ku,e.config.apiKey,e.name)}(t),i=function(e){return Th(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Gu.set(this.auth._key(),e)}return this.bypassAuthState||Gu.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ju(e,t){Gu.set(e._key(),t)}async function Qu(e,t,n=!1){if(ut(e.app))return Promise.reject(Bl(e));const i=Wh(e),r=function(e,t){return t?Th(t):(Hl(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),s=new Yu(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class Xu{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ed(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ed(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(ql(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Zu(e))}saveEventToCache(e){this.cachedEventUids.add(Zu(e)),this.lastProcessedEventTime=Date.now()}}function Zu(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function ed({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const td=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nd=/^https?/;function id(e){const t=zl(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!nd.test(n))return!1;if(td.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const rd=new Gl(3e4,6e4);function sd(){const e=Su().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function od(e){return new Promise(((t,n)=>{var i,r,s;function o(){sd(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{sd(),n(ql(e,"network-request-failed"))},timeout:rd.get()})}if(null===(r=null===(i=Su().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Su().gapi)||void 0===s?void 0:s.load)){const t=zh("iframefcb");return Su()[t]=()=>{gapi.load?o():n(ql(e,"network-request-failed"))},$h(`${Vh.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ad=null,e}))}let ad=null;const cd=new Gl(5e3,15e3),ld="__/auth/iframe",hd="emulator/auth/iframe",ud={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dd=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pd(e){const t=e.config;Hl(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Yl(t,hd):`https://${e.config.authDomain}/${ld}`,i={apiKey:t.apiKey,appName:e.name,v:ft},r=dd.get(e.config.apiHost);r&&(i.eid=r);const s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${q(i).slice(1)}`}const fd={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class md{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const gd=encodeURIComponent("fac");async function _d(e,t,n,i,r,s){Hl(e.config.authDomain,e,"auth-domain-config-required"),Hl(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:ft,eventId:r};if(t instanceof cu){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",M(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof lu){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),l=c?`#${gd}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Yl(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${q(a).slice(1)}${l}`}const vd="webStorageSupport",yd=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Tu,this._completeRedirectFn=Qu,this._overrideRedirectResult=Ju}async _openPopup(e,t,n,i){var r;return $l(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},fd),{width:i.toString(),height:r.toString(),top:s,left:o}),l=w().toLowerCase();n&&(a=Ah(l)?"_blank":n),Nh(l)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=w()){var t;return xh(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new md(null);const u=window.open(t||"",a,h);Hl(u,e,"popup-blocked");try{u.focus()}catch(e){}return new md(u)}(e,await _d(e,t,n,zl(),i),Cu())}async _openRedirect(e,t,n,i){return await this._originValidation(e),r=await _d(e,t,n,zl(),i),Su().location.href=r,new Promise((()=>{}));var r}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):($l(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return ad=ad||od(e),ad}(e),n=Su().gapi;return Hl(n,e,"internal-error"),t.open({where:document.body,url:pd(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ud,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=ql(e,"network-request-failed"),s=Su().setTimeout((()=>{i(r)}),cd.get());function o(){Su().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new Xu(e);return t.register("authEvent",(t=>(Hl(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(vd,{type:vd},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[vd];void 0!==r&&t(!!r),Fl(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return eh(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(id(e))return}catch(e){}Fl(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Uh()||Ph()||xh()}};var wd="@firebase/auth",Id="1.7.5";class bd{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Hl(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Td=_("authIdTokenMaxAge")||300;let Ed=null;var Cd,kd;Cd={loadJS:e=>new Promise(((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=ql("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Vh=Cd,kd="Browser",lt(new Z("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Hl(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:kd,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Fh(kd)},c=new Bh(n,i,r,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Th);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),lt(new Z("auth-internal",(e=>{return t=Wh(e.getProvider("auth").getImmediate()),new bd(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),_t(wd,Id,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(kd)),_t(wd,Id,"esm2017");const Sd=mt({apiKey:"AIzaSyCeL875YW20dLfoeNxfR-EU4TeIPqkWc1Q",authDomain:"brainiacwiz.firebaseapp.com",databaseURL:"https://brainiacwiz-default-rtdb.firebaseio.com",projectId:"brainiacwiz",storageBucket:"brainiacwiz.appspot.com",messagingSenderId:"267854852662",appId:"1:267854852662:web:029b05fe4aa7abd0eb5e97",measurementId:"G-SZ59WLGCXV",storageBucket:"brainiacwiz.appspot.com"}),Rd=(function(e=gt()){const t=ht(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ht(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(U(n.getOptions(),null!=t?t:{}))return e;Fl(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:yd,persistence:[Fu,Iu,Tu]}),i=_("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Td)return;const i=null==t?void 0:t.token;Ed!==i&&(Ed=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){X(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e){X(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}var r;const s=f("auth");s&&function(e,t,n){const i=Wh(e);Hl(i._canInitEmulator,i,"emulator-config-failed"),Hl(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=Jh(t),{host:o,port:a}=function(e){const t=Jh(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:Qh(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Qh(t)}}}(t),c=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`)}(Sd),new uu,new du,function(e=gt(),t){const n=ht(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=m("database");e&&function(e,t,n,i={}){(e=X(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&un("Cannot call useEmulator() after instance has already been initialized.");const r=e._repoInternal;let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&un('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Nn(Nn.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:y(i.mockUserToken,e.app.options.projectId);s=new Nn(t)}!function(e,t,n,i){e.repoInfo_=new Mn(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(r,t,n,s)}(n,...e)}return n}(Sd));(function(e=gt()){ht(e=X(e),"performance").getImmediate()})(Sd),function(e=gt()){const t=ht(e=X(e),il);t.isInitialized()?t.getImmediate():function(e,t={}){const n=ht(e,il);if(n.isInitialized()){const e=n.getImmediate();if(U(t,n.getOptions()))return e;throw dl.create("already-initialized")}n.initialize({options:t})}(e)}(Sd),function(e=gt(),t){const n=ht(e=X(e),zt).getImmediate({identifier:t}),i=m("storage");i&&function(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:r}=i;r&&(e._overrideAuthToken="string"==typeof r?r:y(r,e.app.options.projectId))}(e,t,n,i)}(n,...i)}(Sd)},271:(e,t,n)=>{n.d(t,{d:()=>r});var i=n(790);async function r({state:e,url:t}){try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n         {\n          transfers(\n\t\t\t\t\t\t\t\t\t\torderBy: tokenId\n\t\t\t\t\t\t\t\t\t\torderDirection: desc\n\t\t\t\t\t\t\t\t\t\t)\n          {\n\t\t\t\t\t\t\t\t\t\t\t\ttokenId\n\t\t\t\t\t\t\t\t\t\t\t\tfrom\n\t\t\t\t\t\t\t\t\t\t\t\tto\n\t\t\t\t\t\t\t\t\t\t\t\ttransactionHash\n\t\t\t\t\t\t\t\t\t\t\t\tblockTimestamp\n\t\t\t\t\t\t\t\t\t\t\t\tblockNumber\n          }\n         }\n         "})});return(await e.json()).data.transfers}catch(e){throw i.v.errorDetection.consoleError(e.message),new Error(e)}}},387:(e,t,n)=>{n.d(t,{Gu:()=>o,I9:()=>s});var i=n(790);const r={account:null,token:null,tokenURI:[],address:null,networkId:null,totalSupply:null};async function s(e){let t;if(!window.ethereum)throw i.v.errorDetection.consoleError("No Web3 Provider detected. Please install Metamask."),await new Promise((e=>setTimeout(e,2e3))),window.location.href="../../../pages/walletAuth/walletDirect.html",new Error("No Web3 Provider detected. Please install Metamask.");console.log("MetaMask is installed!"),t=new Web3(window.ethereum);try{await window.ethereum.request({method:"eth_requestAccounts"});const n=await t.eth.getAccounts();r.account=n[0],e&&(e.innerHTML=r.account)}catch(e){throw i.v.errorDetection.consoleError("metamask not connected"),await new Promise((e=>setTimeout(e,2e3))),window.location.href="../../../pages/walletAuth/walletDirect.html",new Error("User denied account access, metamask not connected")}return await async function(e){const{origin:t}=window.location,n=await fetch(`${t}/abis/MemoryToken.json`),s=await n.json(),o=await e.eth.net.getId(),a=s.networks[o];if(!a)return i.v.errorDetection.consoleError("Contract not deployed to the current network, switch to CELO Testnet"),void window.open("https://faucet.celo.org/alfajores","_blank");const{abi:c}=s,{address:l}=a,h=new e.eth.Contract(c,l),u=await h.methods.totalSupply().call();r.token=h,r.address=l,r.networkId=o,r.totalSupply=u;const d=await h.methods.balanceOf(r.account).call();for(let e=0;e<d;e++){const t=await h.methods.tokenOfOwnerByIndex(r.account,e).call();let n=await h.methods.tokenURI(t).call();r.tokenURI.push(n)}return console.log("state: ",r),i.v.errorDetection.consoleInfo("Contract Loaded..."),h}(t),r.account}function o(){return r}},790:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(712),r=n(271),s=n(387);const o=new class{constructor(){const{origin:e}=window.location;this.origin=e,this.checkInternetConnection(),this.injectWalletContainer(),this.injectTrackingData(),this.initDOMElements(),this.injectCopyToClipboard(),this.injectProfileLink(),this.url="https://api.studio.thegraph.com/query/72281/celo-subgraph-box/version/latest",this.sentryUrl="",this.errorDetection=new i.A}injectProfileLink(){const e=document.createElement("a");e.href=`${this.origin}/pages/user/profile.html`,e.classList.add("profile-link"),e.innerHTML='<i class="fas fa-user"></i>',this.walletBtn.insertAdjacentElement("afterend",e),this.walletBtn.style.display="none"}checkInternetConnection(){const e=document.createElement("div");e.classList.add("offline-div"),document.body.appendChild(e),window.addEventListener("offline",(()=>{console.log("offline"),e.innerHTML="\n\t\t\t\t<h1>Internet Connection Lost</h1>\n\t\t\t\t<br>\n\t\t\t\t<p>You might have to reload the page.</p>\n\t\t\t\t",e.style.display="flex"})),navigator.onLine||(e.innerHTML="\n\t\t\t\t<h1>Internet Connection Lost</h1>\n\t\t\t\t<br>\n\t\t\t\t<p>You might have to reload the page.</p>\n\t\t\t\t",e.style.display="flex"),window.addEventListener("online",(()=>{console.log("online"),e.innerHTML="<h1>Connection is back on.</h1>",setTimeout((()=>{e.style.display="none"}),1500)}))}initDOMElements(){const e={walletAddress:"#wallet-address-val",walletBtn:".wallet-btn",walletNfts:".wallet-nfts",walletContainer:".wallet-container",closeWalletBtn:"#close-wallet",txItems:".tx-items",collectionBtn:"#collection-btn",transactionBtn:"#transaction-btn",walletContent:".wallet-content",txContent:".tx-content",walletAddressCont:".wallet-address"};Object.keys(e).forEach((t=>{this[t]=document.querySelector(e[t])}))}injectWalletContainer(){document.body.insertAdjacentHTML("afterbegin",'\n\t\t\t\x3c!-- wallet-container --\x3e\n\t\t\t<div class="wallet-container">\n\t\t\t\t<div class="wallet-options">\n\t\t\t\t\t<button id="collection-btn">NFT Collection</button>\n\t\t\t\t\t<button id="transaction-btn">Transactions</button>\n\t\t\t\t\t<span class="close-on-wallet" id="close-wallet"\n\t\t\t\t\t\t><i class="fa-regular fa-circle-xmark"></i\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- show a list of collected nfts --\x3e\n\t\t\t\t<div class="wallet-content">\n\t\t\t\t\t<div class="wallet-header">\n\t\t\t\t\t\t<h1>My NFT Collection</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wallet-body">\n\t\t\t\t\t\t<div class="wallet-nfts"> </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- show user transactions --\x3e\n\t\t\t\t<div class="tx-content">\n\t\t\t\t\t<div class="tx-header">\n\t\t\t\t\t\t<h1>My Transactions</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tx-body">\n\t\t\t\t\t\t\x3c!-- transaction table --\x3e\n\t\t\t\t\t\t<ul class="tx-items"></ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t')}async setNavbar(){await(0,s.I9)(this.walletAddress,1),this.addEventListeners()}addEventListeners(){const e=(e,t,n,i)=>{e.style.display="flex",t.style.display="none",n.classList.add("btn-active"),i.classList.remove("btn-active")};this.walletBtn?.addEventListener("click",(async()=>{this.walletContainer.style.display="flex",this.showCollectedTokens(),this.showTransfers()})),this.closeWalletBtn?.addEventListener("click",(()=>{this.walletContainer.style.display="none",this.walletContent.style.display="none",this.txContent.style.display="none",this.collectionBtn.classList.remove("btn-active"),this.transactionBtn.classList.remove("btn-active")})),this.collectionBtn?.addEventListener("click",(()=>e(this.walletContent,this.txContent,this.collectionBtn,this.transactionBtn))),this.transactionBtn?.addEventListener("click",(()=>e(this.txContent,this.walletContent,this.transactionBtn,this.collectionBtn)))}showCollectedTokens(){this.collectionBtn.classList.add("btn-active"),this.transactionBtn.classList.remove("btn-active"),this.walletContainer.style.display="flex";const e=(0,s.Gu)(),{tokenURI:t}=e;return 0===t.length?(this.walletNfts.innerHTML="<h2>No NFTs collected yet</h2>",this.walletNfts):(this.walletNfts.innerHTML="",t.forEach((e=>{const{origin:t}=window.location;if(!e.includes(t)){const n=e.split("/assets/nft/")[1];e=`${t}/assets/nft/${n}`}this.walletNfts.innerHTML+=`\n          <div class="nft-card">\n              <img src="${e}" alt="NFT" />\n          </div>\n          `})),this.walletNfts)}async showTransfers(){const e=(0,s.Gu)();let t=await(0,r.d)({state:e,url:this.url});this.txItems.innerHTML="",console.log("showing transactions"),t.forEach((t=>{if(t.to.toLowerCase()==e.account.toLowerCase()){const e=new Date(1e3*t.blockTimestamp);t.blockTimestamp=e.toLocaleString(),this.txItems.innerHTML+=`\n\t\t\t\t<li class="tx-item">\n\t\t\t\t\t<span><p class="tx-item-p">TokenID: </p>${t.tokenId}</span>\n\t\t\t\t\t<span><p class="tx-item-p">TxHash: </p>${t.transactionHash}</span>\n\t\t\t\t\t<span><p class="tx-item-p">From: </p>${t.from}</span>\n\t\t\t\t\t<span><p class="tx-item-p">To: </p>${t.to}</span>\n\t\t\t\t\t<span><p class="tx-item-p">Date: </p>${t.blockTimestamp}</span>\n\t\t\t\t\t<span><p class="tx-item-p">Block No: </p>${t.blockNumber}</span>\n\t\t\t\t</li>`}}))}async injectTrackingData(){document.head.insertAdjacentHTML("beforeend","\x3c!-- Google tag (gtag.js) --\x3e\n      <script async src=\"https://www.googletagmanager.com/gtag/js?id=G-PV2XS36JE2\"><\/script>\n      <script>\n        window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag('js', new Date());\n          gtag('config', 'G-PV2XS36JE2');\n      <\/script>");const e=document.createElement("script");e.src="https://js.sentry-cdn.com/28e0779f6d4ee26fe0de02fcc3239280.min.js",e.crossOrigin="anonymous",document.head.appendChild(e),document.head.insertAdjacentHTML("beforeend","\x3c!-- Sentry.io tracking --\x3e\n\t  \t<script>\n\t\t\tSentry.onLoad(function() {\n\t\t\t\tSentry.init({\n\t\t\t\t// Performance Monitoring\n\t\t\t\ttracesSampleRate: 1.0,\n\t\t\t\t// Session Replay\n\t\t\t\treplaysSessionSampleRate: 0.1, \n\t\t\t\treplaysOnErrorSampleRate: 1.0, \n\t\t\t\t});\n\t\t\t});\n\t\t<\/script>")}injectCopyToClipboard(){this.walletAddressCont.insertAdjacentHTML("beforeend",'<button id="copy-btn"><i class="fas fa-copy"></i></button>'),this.copyToClipboard()}copyToClipboard(){const e=document.querySelector("#copy-btn");e.addEventListener("click",(()=>{try{navigator.clipboard.writeText(this.walletAddress.textContent),e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.innerHTML='<i class="fas fa-copy"></i>'}),1e3)}catch(t){alert("Failed to copy to clipboard"),e.innerHTML='<i class="fas fa-times"></i>',this.errorDetection.consoleError(t.message),setTimeout((()=>{e.innerHTML='<i class="fas fa-copy"></i>'}),1e3)}}))}};o.setNavbar()}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i=n(534),r=n(165);const s=document.querySelector("#ranking-body");(0,r.g)(),async function e(){const t=await(0,i.W$)();s.innerHTML="";let n=t.sort(((e,t)=>t.points-e.points));const r={};n.forEach((e=>{e.campaign&&(e.gamePin=e.campaign),r[e.gamePin]||(r[e.gamePin]=[]),r[e.gamePin].push(e)})),Object.keys(r).forEach((async e=>{const t=r[e],n=document.createElement("tr");n.innerHTML=`\n\t\t\t<td colspan="6" class="game-pin-col">${e}</td>\n\t\t`;let i=[n];await t.forEach((async(e,t)=>{const{dateString:n,startDateString:r,durationString:s}=await async function({player:e}){const t=new Date(e.time),n=`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`,i=new Date(e.startTime),r=`${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}`,s=e.time-e.startTime;let o=Math.floor(s/36e5),a=Math.floor(s%36e5/6e4),c=Math.floor(s%6e4/1e3);o=o<0?"00":o,a=a<0?"00":a,c=c<0?"00":c;return{dateString:n,startDateString:r,durationString:`${o}:${a}:${c}`}}({player:e}),o=document.createElement("tr");o.innerHTML=`\n\t\t\t\t<td>${t+1}</td>\n\t\t\t\t<td>${e.username}</td>\n\t\t\t\t<td>${e.points}</td>\n\t\t\t\t<td>${r}</td>\n\t\t\t\t<td>${n}</td>\n\t\t\t\t<td>${s}</td>\n\t\t\t`,i.push(o)})),s.append(...i)})),setTimeout((()=>{window.requestAnimationFrame(e)}),1e3)}()})();